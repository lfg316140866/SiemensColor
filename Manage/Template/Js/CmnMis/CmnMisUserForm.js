CmnMis_UserForm_CmnMisUserForm_Version = "2.1", "undefined" == typeof CmnMis && (CmnMis = {}), CmnMis.UserForm = function () {
    var _Self, _Condition, _FixedCondition, _ViewStateData, _IsHasSortCol, _SortColName, CheckIsInSortable, SetSortButtonState, AddDetailUserFormInfoToParam, AddRec, UpdateRec, DeleteRec, GetUserFormInfo, ClearAllEvent, LoadListTemplate, LoadEditTemplate, LoadJsTemplate, InitAfterLoadTpl, InitEditPanelControl, InitEditPanelData, GetKeyColTitle; this.Cfg = { MethodName: { GetColumnInfo: "GetColumnInfo", GetRecList: "GetRecList", AddRec: "AddRec", UpdateRec: "UpdateRec", DeleteRec: "DeleteRec", SearchRec: "SearchRec" }, ViewState: { RecList: "RecList", Add: "Add", Update: "Update", View: "View" } }, _Self = this, this.ItfUrl = "", this.UserFormID = "", this.UserFormDesc = "", this.UserFormUrl = "", this.UserFormIcon = "", this.RecPageSize = "15", this.ColInfo = new Array, this.ColInfoRecList = new Array, this.KeyColName = "", this.CurRecID = "", this.CurViewState = _Self.Cfg.ViewState.RecList, this.SearchCol = "", this.SearchContent = "", this.DataPaging = null, this.ModuleDesc = "", this.ModuleID = "", this.ModuleIcon = "", this.RootModuleDesc = "", this.RootModuleID = "", this.RootModuleIcon = "", this.SortByColName = "", this.SortByDirection = "", this.TableName = "", this.IsDetailUserForm = !1, this.ParentUserFormID = "", this.TableCache = null, this.IsShowInMenu = !0, this.ParentModule = null, _Condition = "", _FixedCondition = "", _ViewStateData = null, _IsHasSortCol = !1, _SortColName = "", this.ListTemplateFileName = null, this.EditTemplateFileName = null, this.JsTemplateFileName = null, this.ListTemplateContent = null, this.EditTemplateContent = null, this.JsTemplateContent = null, this.EventBeforeGetRecList = null, this.EventBeforeFillRecList = null, this.EventAfterRecListLoad = null, this.EventAfterSave = null, this.EventAfterAddSave = null, this.EventAfterUpdateSave = null, this.EventInitComplete = null, this.EventUpdateInitComplete = null, this.EventAddInitComplete = null, this.EventBeforeDelete = null, this.EventAfterDelete = null, this.EventBeforeAddSave = null, this.EventBeforeUpdateSave = null, this.EventBeforeSave = null, this.EventOnCancel = null, this.EventOnLeave = null, this.BeforeGetRecList = new Cmn.Event(this), this.BeforeFillRecList = new Cmn.Event(this), this.AfterRecListLoad = new Cmn.Event(this), this.AfterSave = new Cmn.Event(this), this.AfterAddSave = new Cmn.Event(this), this.AfterUpdateSave = new Cmn.Event(this), this.OnInitComplete = new Cmn.Event(this), this.OnUpdateClick = new Cmn.Event(this), this.OnUpdateInitComplete = new Cmn.Event(this), this.OnAddClick = new Cmn.Event(this), this.OnAddInitComplete = new Cmn.Event(this), this.BeforeDelete = new Cmn.Event(this), this.AfterDelete = new Cmn.Event(this), this.BeforeAddSave = new Cmn.Event(this), this.BeforeUpdateSave = new Cmn.Event(this), this.BeforeSave = new Cmn.Event(this), this.OnCancel = new Cmn.Event(this), this.OnLeave = new Cmn.Event(this), this.AllowAdd = "0", this.AllowDell = "0", this.AllowModify = "0", this.AllowToExcel = "0", this.Selector = { ColTitle: ".cmn-ColTitle", ColName: ".cmn-ColName", RecContainer: ".cmn-Rec", RecPager: ".cmn-RecPage", EditControlPanel: ".cmn-EditPanel", RecListView: ".cmn-RecListView", AddEditView: ".cmn-AddEditView", btnReturn: ".cmn-btnReturn", btnSave: ".cmn-btnSave", btnSearch: ".cmn-btnSearch", SearchContent: ".cmn-SearchContent", StartSearchValue: ".cmn-StartSearchValue", SearchColSelect: ".cmn-SearchColSelect", btnCancelSearch: ".cmn-btnCancelSearch", cbxIsSearchInResult: ".cmn-IsSearchInResult", cbxIsIntervalSearch: ".cmn-IsIntervalSearch", RecCount: ".cmn-RecCount", OptDelete: ".cmn-opt-Delete", OptUpdate: ".cmn-opt-Update", OptView: ".cmn-opt-View", OptAdd: ".cmn-opt-Add", btnDownloadCsv: ".cmn-DownloadCsv", btnSetUserForm: ".cmn-btnSetUserForm", btnDebugSelectSql: ".cmn-btnDebugSelectSql" }, this.GetUserFormSelector = function () { var a = ".cmn-UserFormTemplate[name='cmn-UserForm" + this.UserFormID + (this.IsDetailUserForm ? "_" + this.ParentUserFormID : "") + "']"; return a }, this.GetSelector = function (a) { var b = this.GetUserFormSelector(); return void 0 != a && "" != a && (b += " " + a + ":not(" + this.GetUserFormSelector() + " .cmn-UserFormTemplate " + a + ")"), b }, CheckIsInSortable = function () { var a = "desc", b = _Self.GetColInfo(_SortColName); return "asc" == b["ControlCfg"]["Direction"] && (a = "asc"), _Self.SortByColName == _SortColName && _Self.SortByDirection == a ? !0 : (1 == confirm("现在未处于排序状态！是否要进入排序状态？") && (_Self.SortByColName = _SortColName, _Self.SortByDirection = a, _Self.GetRecList(null, null, _Self.DataPaging.Paging.CurrPage), $(_Self.GetSelector(_Self.Selector.ColTitle)).each(function () { $(this).html($(this).html().replace("↓", "").replace("↑", "")) })), !1) }, this.GetRecAjaxParam = function () { var b, a = {}; return "" != _Self.SearchContent && (a["SearchCol"] = _Self.SearchCol, a["SearchContent"] = _Self.SearchContent), b = "", "" != _FixedCondition ? (b = _FixedCondition, "" != _Condition && (b = "(" + b + ") and (" + _Condition + ")")) : "" != _Condition && (b = _Condition), "" != b && (a["Condition"] = b), "" != _Self.SortByColName && (a["SortBy"] = "[" + _Self.SortByColName + "] " + _Self.SortByDirection), a }, SetSortButtonState = function () { if (!_IsHasSortCol != !0) { $(".cg-SortUp img").attr("src", "Image/SortUp.gif"), $(".cg-SortDown img").attr("src", "Image/SortDown.gif"); var a = ""; 1 == _Self.DataPaging.Paging.CurrPage && (a = $(_Self.GetSelector(".cg-SortUp img")), a.length > 0 && a.eq(0).attr("src", "Image/SortUpGray.gif")), _Self.DataPaging.Paging.GetPageCount() == _Self.DataPaging.Paging.CurrPage && (a = $(_Self.GetSelector(".cg-SortDown img")), a.length > 0 && a.eq(a.length - 1).attr("src", "Image/SortDownGray.gif")) } }, this.GetRecList = function (a, b, c) { var d, e, f, g; if (_Self.EventBeforeGetRecList && _Self.EventBeforeGetRecList(), _Self.BeforeGetRecList.Trigger(), CmnMis.Frame.EventBeforeEveryGetRecList && CmnMis.Frame.EventBeforeEveryGetRecList(), CmnMis.Frame.BeforeEveryGetRecList.Trigger([_Self]), c || (c = 1), d = _Self.GetRecAjaxParam(), "1" == _Self.AllowToExcel) { e = CmnMis.Func.GetItfUrl(_Self, _Self.Cfg.MethodName.GetRecList); for (f in d) e = Cmn.Func.AddParamToUrl(e, f + "=" + encodeURIComponent(d[f])); "excel" == CmnMis.Func.GetSysCfg("OutputFileFormat").toLowerCase() ? ($(_Self.GetSelector(_Self.Selector.btnDownloadCsv) + " span").eq(1).html("导出Excel"), e = Cmn.Func.AddParamToUrl(CmnAjax.Func.GetProxyUrl(e), "method=GetExcel&FileName=" + _Self.UserFormID)) : e = Cmn.Func.AddParamToUrl(CmnAjax.Func.GetProxyUrl(e), "method=GetCSV"), $(_Self.GetSelector(_Self.Selector.btnDownloadCsv)).attr("href", e) } else $(_Self.GetSelector(_Self.Selector.btnDownloadCsv)).hide(); $(_Self.GetSelector(_Self.Selector.RecListView)).hide(), _Self.DataPaging = new CmnMis.TableOpt.DataPaging(_Self.GetSelector(_Self.Selector.RecContainer), _Self, d, _Self.GetSelector(_Self.Selector.RecPager), _Self.RecPageSize, function (b) { var c, d, e, f, g, h, i; CmnMis.Func.IsLoginFromAjax(b) !== !1 && ("1" == _Self.AllowModify ? $(_Self.GetSelector(_Self.Selector.OptUpdate)).unbind("click").bind("click", function () { var a = _Self.GetCurRecKeyVal(this); _Self.OnUpdateClick.Trigger([a]) !== !1 && (null == CmnMis.Frame || CmnMis.Frame.OnEveryUpdateClick.Trigger([_Self]) !== !1) && (_Self.FillEditPanelData(a), _Self.CurRecID = a, _Self.ShowViewState(_Self.Cfg.ViewState.Update), $(_Self.GetSelector(_Self.Selector.btnSave)).show(), $(_Self.GetSelector(_Self.Selector.btnReturn)).show()) }) : $(_Self.GetSelector(_Self.Selector.OptUpdate)).hide(), "1" == _Self.AllowAdd ? $(_Self.GetSelector(_Self.Selector.OptAdd)).unbind("click").bind("click", function () { var a, b, c; if (_Self.OnAddClick.Trigger() !== !1 && (null == CmnMis.Frame || CmnMis.Frame.OnEveryAddClick.Trigger([_Self]) !== !1)) { if (_Self.ShowViewState(_Self.Cfg.ViewState.Add), InitEditPanelData(), void 0 != _ViewStateData && null != _ViewStateData && void 0 != _ViewStateData.data && null != _ViewStateData.data) for (a in _ViewStateData.data) for (b = 0; b < _Self.ColInfo.length; b++) if (_Self.ColInfo[b].ColName == a) { c = _Self.GetControlByName(a), null != c && (c.SetValue(_ViewStateData.data[a]), c.SetEnabled(!1)); break } null != _Self.EventAddInitComplete && _Self.EventAddInitComplete(), _Self.OnAddInitComplete.Trigger(), null != CmnMis.Frame && null != CmnMis.Frame.EventEveryAddInitComplete && CmnMis.Frame.EventEveryAddInitComplete(), null != CmnMis.Frame && CmnMis.Frame.OnEveryAddInitComplete.Trigger([_Self]), $(_Self.GetSelector(_Self.Selector.btnSave)).show(), $(_Self.GetSelector(_Self.Selector.btnReturn)).show() } }) : $(_Self.GetSelector(_Self.Selector.OptAdd)).hide(), $(_Self.GetSelector(_Self.Selector.OptView)).unbind("click").bind("click", function () { var a = _Self.GetCurRecKeyVal(this); $(_Self.GetSelector(_Self.Selector.AddEditView)).addClass("EditorInterfacePopWrap"), $(_Self.GetSelector(_Self.Selector.AddEditView)).show(), $("html").css("overflow-y", "hidden"), _Self.FillEditPanelData(a), _Self.CurRecID = a, $(_Self.GetSelector(_Self.Selector.btnSave)).hide(), $(_Self.GetSelector(_Self.Selector.btnReturn)).hide() }), $(_Self.GetSelector(_Self.Selector.AddEditView) + " .CloseEditorInterfacePopWrap").unbind("click").bind("click", function () { var a = $(_Self.GetSelector(_Self.Selector.AddEditView)); a.hasClass("EditorInterfacePopWrap") && (a.removeClass("EditorInterfacePopWrap"), a.hide(), $("html").css("overflow-y", "auto")) }), "1" == _Self.AllowDell ? $(_Self.GetSelector(_Self.Selector.OptDelete)).unbind("click").bind("click", function () { var a = _Self.GetCurRecKeyVal(this); if (_Self.ShowViewState(_Self.Cfg.ViewState.RecList, !0), _Self.CurRecID = a, confirm('是否确定要删除 "' + GetKeyColTitle() + '" 为 "' + _Self.CurRecID + '" 记录？')) { if (_Self.EventBeforeDelete && _Self.EventBeforeDelete(_Self.CurRecID) === !1) return; if (_Self.BeforeDelete.Trigger([_Self.CurRecID]) === !1) return; if (null != CmnMis.Frame && CmnMis.Frame.EventBeforeEveryDelete && 0 == CmnMis.Frame.EventBeforeEveryDelete(_Self.CurRecID)) return; if (null != CmnMis.Frame && CmnMis.Frame.BeforeEveryDelete.Trigger([_Self, _Self.CurRecID]) === !1) return; DeleteRec(function (a) { "1" == a.IsSuccess ? Cmn.alert("删除成功！") : Cmn.alert("删除失败！"), _Self.EventAfterDelete && _Self.EventAfterDelete("1" == a.IsSuccess ? !0 : !1, _Self.CurRecID), _Self.AfterDelete.Trigger(["1" == a.IsSuccess ? !0 : !1, _Self.CurRecID]), _Self.GetRecList(null, null, _Self.DataPaging.Paging.CurrPage) }) } }) : $(_Self.GetSelector(_Self.Selector.OptDelete)).hide(), $(_Self.GetSelector(_Self.Selector.btnReturn)).unbind("click").bind("click", function () { _Self.ShowViewState(_Self.Cfg.ViewState.RecList), _Self.EventOnCancel && _Self.EventOnCancel(), _Self.OnCancel.Trigger(), null != CmnMis.Frame && CmnMis.Frame.EventOnEveryCancel && CmnMis.Frame.EventOnEveryCancel(), null != CmnMis.Frame && CmnMis.Frame.OnEveryCancel.Trigger([_Self]) }), c = !1, $(_Self.GetSelector(_Self.Selector.btnSave)).unbind("click").bind("click", function () { if (c) return Cmn.alert("正在保存中...，请不要重复提交！"), void 0; if (c = !0, null != _Self.EventBeforeSave && _Self.EventBeforeSave() === !1) return c = !1, void 0; if (_Self.BeforeSave.Trigger() === !1) return c = !1, void 0; if (null != CmnMis.Frame && null != CmnMis.Frame.EventBeforeEverySave && CmnMis.Frame.EventBeforeEverySave() === !1) return c = !1, void 0; if (null != CmnMis.Frame && CmnMis.Frame.BeforeEverySave.Trigger([_Self]) === !1) return c = !1, void 0; if (_Self.CurViewState == _Self.Cfg.ViewState.Update) { if (null != _Self.EventBeforeUpdateSave && _Self.EventBeforeUpdateSave(_Self.CurRecID) === !1) return c = !1, void 0; if (_Self.BeforeUpdateSave.Trigger([_Self.CurRecID]) === !1) return c = !1, void 0; if (null != CmnMis.Frame && null != CmnMis.Frame.EventBeforeEveryUpdateSave && CmnMis.Frame.EventBeforeEveryUpdateSave(_Self.CurRecID) === !1) return c = !1, void 0; if (null != CmnMis.Frame && CmnMis.Frame.BeforeEveryUpdateSave.Trigger([_Self, _Self.CurRecID]) === !1) return c = !1, void 0; UpdateRec(function () { c = !1 }, function () { c = !1 }) } else if (_Self.CurViewState == _Self.Cfg.ViewState.Add) { if (null != _Self.EventBeforeAddSave && _Self.EventBeforeAddSave(_Self.CurRecID) === !1) return c = !1, void 0; if (_Self.BeforeAddSave.Trigger([_Self.CurRecID]) === !1) return c = !1, void 0; if (null != CmnMis.Frame && null != CmnMis.Frame.EventBeforeEveryAddSave && CmnMis.Frame.EventBeforeEveryAddSave(_Self.CurRecID) === !1) return c = !1, void 0; if (null != CmnMis.Frame && CmnMis.Frame.BeforeEveryAddSave.Trigger([_Self, _Self.CurRecID]) === !1) return c = !1, void 0; AddRec(function () { c = !1 }, function () { c = !1 }) } }), _IsHasSortCol && (d = null, e = !1, "asc" == _Self.GetColInfo(_SortColName)["ControlCfg"]["Direction"] && (e = !0), f = function (a) { var b = Cmn.Func.Trim($(a).find(".dat-" + _SortColName + " .cg-tmp-" + _SortColName).html()); if ("" == b) try { b = parseInt(_Self.GetCurRecKeyVal(a)) } catch (c) { return Cmn.alert("排序字段的值存在问题！请联系系统维护人员。"), void 0 } else b = parseInt(b); return b }, g = function (a, b) { var g, h, i, j, k, l, c = new Array, d = _SortColName.toLowerCase(); for (a--, b--, g = a; b >= g; g++) h = $(_Self.GetSelector(_Self.Selector.RecContainer)).eq(g), i = {}, i[_Self.KeyColName.toLowerCase()] = _Self.GetCurRecKeyVal(h), i[d] = f(h), c[c.length] = i; for (g = 0; g < c.length; g++) { for (j = c[g][d], k = g + 1; k < c.length; k++) (0 == e && c[k][d] > j || 1 == e && c[k][d] < j) && (l = c[k][d], c[k][d] = j, j = l); c[g][d] = j, h = $(_Self.GetSelector(_Self.Selector.RecContainer)).eq(a + g), $(h).find(".dat-" + _SortColName + " .cg-tmp-" + _SortColName).html(c[g][d]) } return c }, h = $(_Self.GetSelector(_Self.Selector.RecContainer)).eq(0).parent(), h.sortable({ opacity: .8, axis: "y", cursor: "move", start: function (a, b) { d = $(b.item).index() }, cancel: ".MenuFunctionLoacitionListTitle", stop: function (a, b) { var c, e, f; return 0 == CheckIsInSortable() ? (h.sortable("cancel"), void 0) : (c = $(b.item).index(), 0 == c ? (h.sortable("cancel"), void 0) : (e = null, d != c && (d > c && (e = d, d = c, c = e), f = g(d, c), CmnMis.TableOpt.BatchUpdate(_Self, f, function () { }, function () { alert("排序更新失败！请刷新页面后重新排序。") }), SetSortButtonState()), void 0)) } }), i = function (a, b) { var c, d, h, i, j; 0 != CheckIsInSortable() && (c = $(a).parents(_Self.Selector.RecContainer).eq(0), d = null, h = null, b === !1 && $(c).next().length > 0 ? (c.insertAfter($(c).next()), d = g($(c).index() - 1, $(c).index())) : b === !0 && $(c).prev().length > 0 && $(c).prev().index() > 0 ? (c.insertBefore($(c).prev()), d = g($(c).index(), $(c).index() + 1)) : (d = new Array, i = {}, i[_Self.KeyColName.toLowerCase()] = _Self.GetCurRecKeyVal(c), i[_SortColName.toLowerCase()] = f(c), d[d.length] = i, j = _Self.GetRecAjaxParam(), j.Condition = void 0 == j.Condition ? "[" + _SortColName + "]" + (0 == e && b === !0 || 1 == e && b === !1 ? ">" : "<") + i[_SortColName.toLowerCase()] : "(" + j.Condition + ") and ([" + _SortColName + "]" + (0 == e && b === !0 || 1 == e && b === !1 ? ">" : "<") + i[_SortColName.toLowerCase()] + ")", j.SortBy = 0 == e && b === !0 || 1 == e && b === !1 ? "[" + _SortColName + "]" : "[" + _SortColName + "] desc ", j["PageSize"] = "1", j["CurPage"] = "1", CmnMis.TableOpt.GetData(_Self, j, !0, function (a) { if (a.data.length < 1) b === !0 ? alert("这已经是第一条记录了！") : alert("这已经是最后一条记录了！"); else { i = {}, i[_Self.KeyColName.toLowerCase()] = a.data[0][_Self.KeyColName], i[_SortColName.toLowerCase()] = a.data[0][_SortColName], d[d.length] = i; var c = d[0][_SortColName.toLowerCase()]; d[0][_SortColName.toLowerCase()] = d[1][_SortColName.toLowerCase()], d[1][_SortColName.toLowerCase()] = c } }), h = function () { _Self.GetRecList(null, null, _Self.DataPaging.Paging.CurrPage) }), d.length >= 2 && CmnMis.TableOpt.BatchUpdate(_Self, d, h, function () { alert("排序更新失败！请刷新页面后重新排序。") }), SetSortButtonState()) }, $(_Self.GetSelector(".cg-SortUp")).unbind("click").bind("click", function () { i(this, !0) }), $(_Self.GetSelector(".cg-SortDown")).unbind("click").bind("click", function () { i(this, !1) })), null != _Self.EventAfterRecListLoad && _Self.EventAfterRecListLoad(), _Self.AfterRecListLoad.Trigger(), null != CmnMis.Frame && null != CmnMis.Frame.EventAfterEveryRecListLoad && CmnMis.Frame.EventAfterEveryRecListLoad(), null != CmnMis.Frame && CmnMis.Frame.AfterEveryRecListLoad.Trigger([_Self]), $(_Self.GetSelector(_Self.Selector.RecCount)).html(b.RecCount), $(_Self.GetSelector(_Self.Selector.RecListView)).stop(!0, !0).slideDown(1e3), SetSortButtonState(), null != a && void 0 != a && a(b)) }, function () { Cmn.alert("数据填充失败！可能是网络原因，请重试。") }, null, c, function (a) { var b, c, d, e, f, g, h; if (a.length > 0 && _Self.ColInfoRecList.length > 0 && void 0 === _Self.ColInfoRecList[0]["IsCanSort"]) for (b = 0; b < _Self.ColInfoRecList.length; b++) _Self.ColInfoRecList[b]["IsCanSort"] = void 0 != a[0][_Self.ColInfoRecList[b]["ColName"]] ? "1" : "0"; if (_Self.EventBeforeFillRecList && _Self.EventBeforeFillRecList(a), _Self.BeforeFillRecList.Trigger([a]), null != CmnMis.Frame && CmnMis.Frame.EventBeforeEveryFillRecList && CmnMis.Frame.EventBeforeEveryFillRecList(a), null != CmnMis.Frame && CmnMis.Frame.BeforeEveryFillRecList.Trigger([_Self, a]), _IsHasSortCol) for (c = _Self.DataPaging.Paging.GetPageCount(), b = 0; b < a.length; b++) d = "", d = 0 == b && 1 == _Self.DataPaging.Paging.CurrPage ? " <span class='cg-SortUp' style='cursor:pointer;padding:2px;'><img src='Image/SortUpGray.gif' /></span>" : " <span class='cg-SortUp' style='cursor:pointer;padding:2px;'><img src='Image/SortUp.gif' /></span>", d += b == a.length - 1 && _Self.DataPaging.Paging.CurrPage == c ? "<span class='cg-SortDown' style='cursor:pointer;padding:2px;'><img src='Image/SortDownGray.gif' /></span>" : "<span class='cg-SortDown' style='cursor:pointer;padding:2px;'><img src='Image/SortDown.gif' /></span>", a[b][_SortColName] = d + "<span class='cg-tmp-" + _SortColName + "'  style='display: none;' >" + a[b][_SortColName] + "</span>"; for (b = 0; b < _Self.ColInfoRecList.length; b++) if (e = _Self.ColInfoRecList[b], "RowControl" != e["ControlCfg"]["ControlType"]) { for (g = 0; g < a.length; g++) if ("" != e["ColFormat"] && (a[g][e["ColName"]] = CmnMis.Func.FormatString(a[g][e["ColName"]], e["ColFormat"])), "ImgUpload" == e["ColControlName"]) a[g][e["ColName"]] && (a[g][e["ColName"]] = "<img src='" + CmnMis.Func.RootPathToManageDir(a[g][e["ColName"]]) + "' width='" + e["ColWidth"] + "' />"); else if ("RadioButton" == e["ColControlName"] || "Select" == e["ColControlName"]) for (h = 0; h < e["ControlCfg"]["OptionList"].length; h++) if (a[g][e["ColName"]] == e["ControlCfg"]["OptionList"][h]["key"]) { a[g][e["ColName"]] = e["ControlCfg"]["OptionList"][h]["value"]; break } } else void 0 == e["RowControl"] && (f = CmnMis.UI.Control[e["ColControlName"]], e["RowControl"] = new f(e["ColName"], e["ControlCfg"], _Self.KeyColName)), e["RowControl"].Init(a), _Self.AfterRecListLoad.Add(function () { e["RowControl"].AfterFillData() }, e["ColName"]) }), _Self.DataPaging.EventBeforePaging = function () { $(_Self.GetSelector(_Self.Selector.RecListView)).hide() }, g = $(_Self.GetSelector(_Self.Selector.RecPager)).attr("ActiveClass"), g && "" != g && (_Self.DataPaging.Paging.ActiveClass = g) }, AddDetailUserFormInfoToParam = function (a) { var b, c, d; for (b = 0; b < _Self.ColInfo.length; b++) ("DetailUserForm" == _Self.ColInfo[b]["ColControlName"] || "EditExd" == _Self.ColInfo[b]["ColControlName"] || "DetailMultiCheckbox" == _Self.ColInfo[b]["ColControlName"]) && (void 0 == a["cg_DetailUserForm"] && (a["cg_DetailUserForm"] = new Array), c = {}, c["ColName"] = _Self.ColInfo[b]["ColName"], void 0 != _Self.ColInfo[b]["ControlCfg"]["UserFormID"] ? c["UserFormID"] = _Self.ColInfo[b]["ControlCfg"]["UserFormID"] : void 0 != _Self.ColInfo[b]["ControlCfg"]["SaveTableName"] ? (d = CmnMis.TableOpt.GetUserForm(_Self.ColInfo[b]["ControlCfg"]["SaveTableName"]), c["UserFormID"] = d.UserFormID) : void 0 != _Self.ColInfo[b]["ControlCfg"]["TableName"] && (d = CmnMis.TableOpt.GetUserForm(_Self.ColInfo[b]["ControlCfg"]["TableName"]), c["UserFormID"] = d.UserFormID), c["ForeignKeyFieldName"] = _Self.ColInfo[b]["ControlCfg"]["ForeignKeyFieldName"], c["MainKeyFieldName"] = void 0 == _Self.ColInfo[b]["ControlCfg"]["MainKeyFieldName"] ? _Self.KeyColName : _Self.ColInfo[b]["ControlCfg"]["MainKeyFieldName"], a["cg_DetailUserForm"][a["cg_DetailUserForm"].length] = c); void 0 != a["cg_DetailUserForm"] && (a["cg_DetailUserForm"] = Cmn.Func.JsonToStr(a["cg_DetailUserForm"])) }, AddRec = function (a, b) { var c = {}; AddDetailUserFormInfoToParam(c), _IsHasSortCol === !0 && (c["Cg_SortFieldName"] = _SortColName), CmnMis.TableOpt.Add(_Self, c, function (b) { return null != _Self.EventAfterSave && _Self.EventAfterSave(b.NewRecID) === !1 ? (null != a && void 0 != a && a(b), void 0) : _Self.AfterSave.Trigger([b.NewRecID]) === !1 ? (null != a && void 0 != a && a(b), void 0) : null != CmnMis.Frame && null != CmnMis.Frame.EventAfterEverySave && CmnMis.Frame.EventAfterEverySave(b.NewRecID) === !1 ? (null != a && void 0 != a && a(b), void 0) : null != CmnMis.Frame && CmnMis.Frame.AfterEverySave.Trigger([_Self, b.NewRecID]) === !1 ? (null != a && void 0 != a && a(b), void 0) : null != _Self.EventAfterAddSave && _Self.EventAfterAddSave(b.NewRecID) === !1 ? (null != a && void 0 != a && a(b), void 0) : _Self.AfterAddSave.Trigger([b.NewRecID]) === !1 ? (null != a && void 0 != a && a(b), void 0) : null != CmnMis.Frame && null != CmnMis.Frame.EventAfterEveryAddSave && CmnMis.Frame.EventAfterEveryAddSave(b.NewRecID) === !1 ? (null != a && void 0 != a && a(b), void 0) : null != CmnMis.Frame && CmnMis.Frame.AfterEveryAddSave.Trigger([_Self, b.NewRecID]) === !1 ? (null != a && void 0 != a && a(b), void 0) : (Cmn.alert("增加成功！"), _Self.ShowViewState(_Self.Cfg.ViewState.RecList, !0), _Self.GetRecList(), null != a && void 0 != a && a(b), void 0) }, function (a) { Cmn.alert("增加失败！错误信息：" + a.ErrMsg), null != b && void 0 != b && b(a) }) }, UpdateRec = function (a, b) { var c = {}; AddDetailUserFormInfoToParam(c), CmnMis.TableOpt.Update(_Self, _Self.CurRecID, function (b) { return null != _Self.EventAfterSave && _Self.EventAfterSave(_Self.CurRecID) === !1 ? (null != a && void 0 != a && a(b), void 0) : _Self.AfterSave.Trigger([_Self.CurRecID]) === !1 ? (null != a && void 0 != a && a(b), void 0) : null != CmnMis.Frame && null != CmnMis.Frame.EventAfterEverySave && CmnMis.Frame.EventAfterEverySave(_Self.CurRecID) === !1 ? (null != a && void 0 != a && a(b), void 0) : null != CmnMis.Frame && CmnMis.Frame.AfterEverySave.Trigger([_Self, _Self.CurRecID]) === !1 ? (null != a && void 0 != a && a(b), void 0) : null != _Self.EventAfterUpdateSave && _Self.EventAfterUpdateSave(_Self.CurRecID) === !1 ? (null != a && void 0 != a && a(b), void 0) : _Self.AfterUpdateSave.Trigger([_Self.CurRecID]) === !1 ? (null != a && void 0 != a && a(b), void 0) : null != CmnMis.Frame && null != CmnMis.Frame.EventAfterEveryUpdateSave && CmnMis.Frame.EventAfterEveryUpdateSave(_Self.CurRecID) === !1 ? (null != a && void 0 != a && a(b), void 0) : null != CmnMis.Frame && CmnMis.Frame.AfterEveryUpdateSave.Trigger([_Self, _Self.CurRecID]) === !1 ? (null != a && void 0 != a && a(b), void 0) : (Cmn.alert("更新成功！"), _Self.ShowViewState(_Self.Cfg.ViewState.RecList, !0), _Self.GetRecList(null, null, _Self.DataPaging.Paging.CurrPage), null != a && void 0 != a && a(b), void 0) }, function (a) { Cmn.alert("更新失败！错误信息：" + a.ErrMsg), null != b && void 0 != b && b(a) }, c) }, DeleteRec = function (a, b) { CmnMis.TableOpt.Delete(_Self, _Self.CurRecID, a, b) }, GetUserFormInfo = function (a) { CmnAjax.PostData(CmnMis.Func.GetItfUrl(_Self, _Self.Cfg.MethodName.GetColumnInfo), "{}", function (b) { if (CmnMis.Func.IsLoginFromAjax(b) !== !1) if ("1" == b.IsSuccess) { _Self.ColInfo = b.data, _Self.KeyColName = b.KeyColName, _Self.ColInfoRecList = []; for (var c = 0; c < _Self.ColInfo.length; c++) "1" == _Self.ColInfo[c].IsShowInGrid && (_Self.ColInfoRecList[_Self.ColInfoRecList.length] = _Self.ColInfo[c]); CmnMis.Func.CheckColInfo(_Self), _Self.AllowAdd = b["AllowAdd"], _Self.AllowDell = b["AllowDell"], _Self.AllowModify = b["AllowModify"], _Self.AllowToExcel = b["AllowToExcel"], a && a(b.data) } else Cmn.DebugLog("获取用户表单信息错误！可能没有字段信息。"), _Self.ColInfo = [], _Self.ColInfoRecList = [], a && a(b.data) }) }, ClearAllEvent = function () { _Self.BeforeGetRecList.Remove(), _Self.BeforeFillRecList.Remove(), _Self.AfterRecListLoad.Remove(), _Self.AfterSave.Remove(), _Self.AfterAddSave.Remove(), _Self.AfterUpdateSave.Remove(), _Self.OnInitComplete.Remove(), _Self.OnUpdateClick.Remove(), _Self.OnUpdateInitComplete.Remove(), _Self.OnAddClick.Remove(), _Self.OnAddInitComplete.Remove(), _Self.BeforeDelete.Remove(), _Self.AfterDelete.Remove(), _Self.BeforeAddSave.Remove(), _Self.BeforeUpdateSave.Remove(), _Self.BeforeSave.Remove(), _Self.OnCancel.Remove(), _Self.OnLeave.Remove() }, this.InitUserForm = function () { ClearAllEvent(), LoadListTemplate(function () { LoadEditTemplate(function () { LoadJsTemplate(function () { InitAfterLoadTpl() }) }) }) }, LoadListTemplate = function (a) { null != _Self.ListTemplateFileName && "" != _Self.ListTemplateFileName && void 0 != _Self.ListTemplateFileName ? null != _Self.ListTemplateContent ? ($(_Self.GetUserFormSelector()).html(_Self.ListTemplateContent), a()) : $(_Self.GetUserFormSelector()).load(CmnMis.Func.RootPathToManageDir(_Self.ListTemplateFileName) + "?rnd=" + Math.random(), null, function (b, c) { "success" == c && (_Self.ListTemplateContent = b, a()) }) : ($(_Self.GetUserFormSelector()).html(CmnMis.Frame.UserFormHtmlCache.DefaultUserFormTemplate), a()) }, LoadEditTemplate = function (a) { null != _Self.EditTemplateFileName && "" != _Self.EditTemplateFileName && void 0 != _Self.EditTemplateFileName ? null != _Self.EditTemplateContent ? ($(_Self.GetSelector(_Self.Selector.AddEditView)).html(_Self.EditTemplateContent), a()) : $(_Self.GetSelector(_Self.Selector.AddEditView)).load(CmnMis.Func.RootPathToManageDir(_Self.EditTemplateFileName) + "?rnd=" + Math.random(), null, function (b, c) { "success" == c && (_Self.EditTemplateContent = b, a()) }) : ($(_Self.GetSelector(_Self.Selector.AddEditView)).html(CmnMis.Frame.UserFormHtmlCache.DefaultAddEditTemplate), a()) }, LoadJsTemplate = function (onComplete) { null != _Self.JsTemplateFileName && "" != _Self.JsTemplateFileName && void 0 != _Self.JsTemplateFileName && (null != _Self.JsTemplateContent && "" != _Self.JsTemplateContent ? eval(_Self.JsTemplateContent + " \r\n//@ sourceURL=" + _Self.JsTemplateFileName) : (_Self.JsTemplateContent = CmnAjax.GetFile(Cmn.Func.AddParamToUrl(CmnMis.Func.RootPathToManageDir(_Self.JsTemplateFileName), "r_=" + Math.random())), _Self.JsTemplateContent = "(function(curUserForm){" + _Self.JsTemplateContent.replace(/CmnMis\.CurUserForm/g, "curUserForm") + "})(CmnMis.Func." + (_Self.IsDetailUserForm ? "GetDetailUserFormInfoByID" : "GetUserFormByID") + "('" + _Self.UserFormID + "'))", eval(_Self.JsTemplateContent + " \r\n//@ sourceURL=" + _Self.JsTemplateFileName))), onComplete() }, InitAfterLoadTpl = function () {
        var a, b, c, d, e, f, g, h; for (Cmn.RemoveFillHtml(_Self.GetSelector(_Self.Selector.ColTitle)), Cmn.RemoveFillHtml(_Self.GetSelector(_Self.Selector.ColName)), Cmn.RemoveFillHtml(_Self.GetSelector(_Self.Selector.RecContainer)), a = '<input type="hidden" class="cmn-KeyVal-' + _Self.KeyColName + '" name="hid' + _Self.KeyColName + '"  value="{' + _Self.KeyColName + '}" />', $(_Self.GetSelector(_Self.Selector.RecContainer)).append(a), $(_Self.GetSelector(_Self.Selector.ColTitle)).append('<input type="hidden" class="cmn-hid-CoName" value="{ColName}" />'), Cmn.FillData(_Self.GetSelector(_Self.Selector.ColTitle), _Self.ColInfoRecList), Cmn.FillData(_Self.GetSelector(_Self.Selector.ColName), _Self.ColInfoRecList), _Self.ShowViewState(_Self.Cfg.ViewState.RecList), InitEditPanelControl(), b = "", c = "", d = "", e = 0; e < _Self.ColInfoRecList.length; e++) b += '<option value="' + _Self.ColInfoRecList[e].ColName + '">' + _Self.ColInfoRecList[e].ColTitle + "</option>", "Sort" == _Self.ColInfoRecList[e].ColControlName && (_IsHasSortCol = !0, _SortColName = _Self.ColInfoRecList[e].ColName), 3 > e && ("" != c && (c += "/"), c += _Self.ColInfoRecList[e].ColName, "" != d && (d += "/"), d += _Self.ColInfoRecList[e].ColTitle); b = '<option value="' + c + '">' + d + "</option>" + b, $(_Self.GetSelector(_Self.Selector.SearchColSelect)).html(b), _Self.SortByColName = "", 1 == _IsHasSortCol && (_Self.SortByColName = _SortColName, f = _Self.GetColInfo(_SortColName), _Self.SortByDirection = "asc" == f["ControlCfg"]["Direction"] ? "asc" : "desc"), $(_Self.GetSelector(_Self.Selector.ColTitle)).unbind("click").bind("click", function () { var a = ""; return $(this).find(".cmn-hid-CoName").length > 0 && (a = $(this).find(".cmn-hid-CoName").val()), "" == a ? (Cmn.Log("未找到对应的字段名！"), void 0) : ("0" != _Self.GetColInfo(a)["IsCanSort"] && ($(_Self.GetSelector(_Self.Selector.ColTitle)).each(function () { $(this).html($(this).html().replace("↓", "").replace("↑", "")) }), _Self.SortByColName == a ? "asc" == _Self.SortByDirection ? (_Self.SortByDirection = "desc", $(this).html($(this).html() + "↓")) : (_Self.SortByDirection = "asc", $(this).html($(this).html() + "↑")) : (_Self.SortByColName = a, _Self.SortByDirection = "desc", $(this).html($(this).html() + "↓")), _Self.GetRecList()), void 0) }), $(_Self.GetSelector(_Self.Selector.cbxIsIntervalSearch)).parent().hide(), $(_Self.GetSelector(_Self.Selector.SearchColSelect)).unbind("change").bind("change", function () { var b, c, d, e, a = $(_Self.GetSelector(_Self.Selector.SearchColSelect)).val(); if ($(_Self.GetSelector(_Self.Selector.cbxIsIntervalSearch)).attr("checked", !1), $(_Self.GetSelector(".FromToInputWrap")).hide(), $(_Self.GetSelector(_Self.Selector.SearchContent)).datetimepicker("destroy"), $(_Self.GetSelector(_Self.Selector.StartSearchValue)).datetimepicker("destroy"), $(_Self.GetSelector(".cmn-SearchContentSelect")).removeClass("cmn-SearchContent"), $(_Self.GetSelector(".cmn-SearchContentSelect")).hide(), $(_Self.GetSelector(".cmn-SearchContentText")).addClass("cmn-SearchContent"), $(_Self.GetSelector(".cmn-SearchContentText")).show(), a.indexOf("/") >= 0) $(_Self.GetSelector(_Self.Selector.cbxIsIntervalSearch)).parent().hide(); else if ($(_Self.GetSelector(_Self.Selector.cbxIsIntervalSearch)).parent().show(), b = _Self.GetColInfo(a), null != b) if ("DateSelect" == b["ColControlName"] && ($(_Self.GetSelector(_Self.Selector.SearchContent)).datetimepicker(), $(_Self.GetSelector(_Self.Selector.StartSearchValue)).datetimepicker(), $(_Self.GetSelector(_Self.Selector.cbxIsIntervalSearch)).attr("checked", !0), $(_Self.GetSelector(".FromToInputWrap")).show()), "RadioButton" == b["ColControlName"] || "Select" == b["ColControlName"]) { for (c = "", d = 0; d < b["ControlCfg"]["OptionList"].length; d++) c += '<option value="' + b["ControlCfg"]["OptionList"][d]["key"] + '">' + b["ControlCfg"]["OptionList"][d]["value"] + "</option>"; "" != c && ($(_Self.GetSelector(".cmn-SearchContentSelect")).html(c).addClass("cmn-SearchContent").show(), $(_Self.GetSelector(".cmn-SearchContentText")).removeClass("cmn-SearchContent").hide(), $(_Self.GetSelector(_Self.Selector.cbxIsIntervalSearch)).parent().hide()) } else if (null != a.match(/disp$/i) && (e = a.replace(/_disp$/i, "").replace(/disp$/i, ""), b = _Self.GetColInfo(e, !1), null != b && ("RadioButton" == b["ColControlName"] || "Select" == b["ColControlName"]))) { for (c = "", d = 0; d < b["ControlCfg"]["OptionList"].length; d++) c += '<option value="' + b["ControlCfg"]["OptionList"][d]["value"] + '">' + b["ControlCfg"]["OptionList"][d]["value"] + "</option>"; "" != c && ($(_Self.GetSelector(".cmn-SearchContentSelect")).html(c).addClass("cmn-SearchContent").show(), $(_Self.GetSelector(".cmn-SearchContentText")).removeClass("cmn-SearchContent").hide(), $(_Self.GetSelector(_Self.Selector.cbxIsIntervalSearch)).parent().hide()) } }), $(_Self.GetSelector(_Self.Selector.btnSearch)).unbind("click").bind("click", function () { var b, c, d, e, a = Cmn.Str.ToSqlStr($(_Self.GetSelector(_Self.Selector.SearchContent)).val()); if ("checked" != $(_Self.GetSelector(_Self.Selector.cbxIsSearchInResult)).attr("checked") && _Self.ClearCondition(), "checked" == $(_Self.GetSelector(_Self.Selector.cbxIsIntervalSearch)).attr("checked")) b = Cmn.Str.ToSqlStr($(_Self.GetSelector(_Self.Selector.StartSearchValue)).val()), "" != a && "" != b ? _Self.AddCondition("[" + $(_Self.GetSelector(_Self.Selector.SearchColSelect)).val() + "] between '" + b + "' and '" + a + "'") : "" != b ? _Self.AddCondition("[" + $(_Self.GetSelector(_Self.Selector.SearchColSelect)).val() + "] >= '" + b + "'") : "" != a && _Self.AddCondition("[" + $(_Self.GetSelector(_Self.Selector.SearchColSelect)).val() + "] <= '" + a + "'"); else if (c = $(_Self.GetSelector(_Self.Selector.SearchColSelect)).val(), "" != a) if (c.indexOf("/") >= 0) { for (c = c.split("/"), d = "", e = 0; e < c.length; e++) "" != d && (d += " or "), d += "[" + c[e] + "] like '%" + a + "%'"; _Self.AddCondition(d) } else $(_Self.GetSelector(_Self.Selector.SearchContent)).hasClass("cmn-SearchContentSelect") ? _Self.AddCondition("[" + c + "] = '" + a + "'") : _Self.AddCondition("[" + c + "] like '%" + a + "%'"); _Self.ShowViewState(_Self.Cfg.ViewState.RecList), _Self.GetRecList() }), $(_Self.GetSelector(_Self.Selector.btnCancelSearch)).unbind("click").bind("click", function () { $(_Self.GetSelector(_Self.Selector.SearchContent)).val(""), _Self.SearchContent = "", _Self.ShowViewState(_Self.Cfg.ViewState.RecList), _Self.GetRecList() }), $(_Self.GetSelector(_Self.Selector.SearchContent)).keypress(function (a) { 13 == a.keyCode && $(_Self.GetSelector(_Self.Selector.btnSearch)).click() }), g = $(_Self.GetSelector(_Self.Selector.cbxIsIntervalSearch)), g.unbind("change").bind("change", function () { "checked" == g.attr("checked") ? $(_Self.GetSelector(".FromToInputWrap")).show() : $(_Self.GetSelector(".FromToInputWrap")).hide() }), CmnMis.Func.IsSysAdmin() ? ($(_Self.GetSelector(_Self.Selector.btnDebugSelectSql)).attr("href", "Tools/UserFormSqlTest.htm?SysName=" + Cmn.Func.GetParamFromUrl("SysName") + "&userformid=" + _Self.UserFormID), $(_Self.GetSelector(_Self.Selector.btnSetUserForm)).unbind("click").bind("click", function () { CmnMis.Func.ShowSetUserFormCol(_Self.UserFormID, _Self.UserFormID) })) : ($(_Self.GetSelector(_Self.Selector.btnDebugSelectSql)).hide(), $(_Self.GetSelector(_Self.Selector.btnSetUserForm)).hide()), h = !1, 0 == h && void 0 != _ViewStateData && null != _ViewStateData && (void 0 != _ViewStateData.Condition && null != _ViewStateData.Condition && _Self.SetFixedCondition(_ViewStateData.Condition), (void 0 != _ViewStateData.ViewState && _ViewStateData.ViewState == _Self.Cfg.ViewState.Add || _ViewStateData.ViewState == _Self.Cfg.ViewState.Update || _ViewStateData.ViewState == _Self.Cfg.ViewState.View) && _Self.ShowViewState(_ViewStateData.ViewState)), _Self.GetRecList(function () {
            var b, c, d; if (0 == h) {
                if (void 0 != _ViewStateData && null != _ViewStateData) {
                    if (_ViewStateData.ViewState == _Self.Cfg.ViewState.Add || _ViewStateData.ViewState == _Self.Cfg.ViewState.Update || _ViewStateData.ViewState == _Self.Cfg.ViewState.View) {
                        if (_Self.ShowViewState(_ViewStateData.ViewState), InitEditPanelData(), void 0 != _ViewStateData.data && null != _ViewStateData.data) if (_ViewStateData.ViewState == _Self.Cfg.ViewState.Add) {
                            for (b in _ViewStateData.data) for (c = 0; c < _Self.ColInfo.length; c++) if (_Self.ColInfo[c].ColName == b) {
                                d = _Self.GetControlByName(b), null != d && d.SetValue(_ViewStateData.data[b]);
                                break
                            }
                        } else void 0 != _ViewStateData.data.RecID && (_Self.FillEditPanelData(_ViewStateData.data.RecID), _Self.CurRecID = _ViewStateData.data.RecID); void 0 != _ViewStateData.ReturnUserFormID && null != _ViewStateData.ReturnUserFormID && _Self.AfterSave.Add(function () { CmnMis.Frame.ShowUserForm(_ViewStateData.ReturnUserFormID, null, _ViewStateData.IsReloadWhenReturn) })
                    } void 0 != _ViewStateData.ReturnUserFormID && null != _ViewStateData.ReturnUserFormID && _Self.OnCancel.Add(function () { CmnMis.Frame.ShowUserForm(_ViewStateData.ReturnUserFormID, null, _ViewStateData.IsReloadWhenReturn) })
                } h = !0
            } null != _Self.EventInitComplete && _Self.EventInitComplete(), _Self.OnInitComplete.Trigger(), null != CmnMis.Frame && null != CmnMis.Frame.EventEveryInitComplete && CmnMis.Frame.EventEveryInitComplete(), null != CmnMis.Frame && CmnMis.Frame.OnEveryInitComplete.Trigger([_Self])
        })
    }, InitEditPanelControl = function () { return _Self.ColInfo ? (CmnMis.UI.Control.CreateControls(_Self), void 0) : !1 }, this.ShowViewState = function (a, b) { var c = 1 == b ? 0 : 1e3; a == _Self.Cfg.ViewState.RecList ? ($(_Self.GetSelector(_Self.Selector.RecListView)).hide().stop(!0, !0).slideDown(c), $(_Self.GetSelector(_Self.Selector.AddEditView)).hide()) : ($(_Self.GetSelector(_Self.Selector.RecListView)).hide(), $(_Self.GetSelector(_Self.Selector.AddEditView)).hide().stop(!0, !0).slideDown(c)), _Self.CurViewState = a }, this.FillEditPanelData = function (a, b) { InitEditPanelData(), CmnMis.TableOpt.GetData(_Self, { RecID: a }, !1, function (c) { CmnMis.Func.IsLoginFromAjax(c) !== !1 && (c.data ? c.data.length > 0 && (CmnMis.UI.Control.SetValueList(_Self.GetSelector(_Self.Selector.EditControlPanel), c.data[0], _Self), null != _Self.EventUpdateInitComplete && _Self.EventUpdateInitComplete(a, c.data[0]), _Self.OnUpdateInitComplete.Trigger([a, c.data[0]]), null != CmnMis.Frame && null != CmnMis.Frame.EventEveryUpdateInitComplete && CmnMis.Frame.EventEveryUpdateInitComplete(a, c.data[0]), null != CmnMis.Frame && CmnMis.Frame.OnEveryUpdateInitComplete.Trigger([_Self, a, c.data[0]]), b && b(c.data[0])) : Cmn.Log("FillEditPanelData中GetRecList的时候data为空,FormDesc:" + _Self.UserFormDesc + " RecID:" + a)) }) }, InitEditPanelData = function () { CmnMis.UI.Control.InitValueList(_Self.GetSelector(_Self.Selector.EditControlPanel)) }, this.AddFixedCondition = function (a) { a && "" != a && ("" != _FixedCondition && (_FixedCondition += " and "), _FixedCondition += "(" + a + ")") }, this.SetFixedCondition = function (a) { _FixedCondition = a }, this.AddCondition = function (a) { a && "" != a && ("" != _Condition && (_Condition += " and "), _Condition += "(" + a + ")") }, this.SetCondition = function (a) { _Condition = a }, this.ClearCondition = function () { _Condition = "" }, this.Show = function (a) { null != CmnMis.CurUserForm && CmnMis.CurUserForm != _Self && (CmnMis.CurUserForm.EventOnLeave && CmnMis.CurUserForm.EventOnLeave(), CmnMis.CurUserForm.OnLeave.Trigger()), CmnMis.CurUserForm = _Self, _ViewStateData = null, null != a && (_ViewStateData = void 0 == a ? null : a), CmnMis.Frame.ActiveUserForm(_Self, !0, !1), $(_Self.GetSelector(_Self.Selector.RecListView)).hide(), _Self.SearchContent = "", $(_Self.GetSelector(_Self.Selector.SearchContent)).val(""), _Condition = "", _FixedCondition = "", GetUserFormInfo(function () { _Self.InitUserForm() }) }, this.GetCurRecKeyVal = function (a) { a = $(a); for (var b = 0; 10 > b; b++) { if (a.find(".cmn-KeyVal-" + _Self.KeyColName).length > 0) return a.find(".cmn-KeyVal-" + _Self.KeyColName).val(); a = a.parent() } return "" }, GetKeyColTitle = function () { for (var a = 0; a < _Self.ColInfo.length; a++) if (_Self.ColInfo[a].ColName == _Self.KeyColName) return _Self.ColInfo[a].ColTitle; return "" }, this.GetControlByName = function (a) { var b = $(_Self.GetSelector(_Self.Selector.EditControlPanel)).find(CmnMis.UI.Control.Selector.Container + "[name='" + a + "']"); return b.length <= 0 && (b = $(_Self.GetSelector(_Self.Selector.EditControlPanel)).find(".cmn-control[name='" + a + "']").parents(CmnMis.UI.Control.Selector.Container)), b.length > 0 ? CmnMis.UI.Control.GetControl($(b)) : null }, this.GetControl = function (a) { return _Self.GetControlByName(a) }, this.GetItfUrl = function (a) { return Cmn.Func.AddParamToUrl(Cmn.Func.AddParamToUrl(_Self.ItfUrl, "CurUserFormID=" + _Self.UserFormID), "method=" + a) }, this.GetCurRecFieldVal = function (a) { return "" == _Self.CurRecID && Cg.Log("警告：CurRecID 为空"), $(_Self.GetUserFormSelector()).find(".cmn-KeyVal-info_id[value=" + _Self.CurRecID + "]").parents(".cmn-Rec").find(".cmn-ColName.dat-" + a).text() }, this.RefreshData = function () { _Self.GetRecList() }, this.GetShowViewStateData = function () { return _ViewStateData }, this.GetColInfo = function (a, b) { var c; if (b === !1) { for (c = 0; c < _Self.ColInfo.length; c++) if (_Self.ColInfo[c]["ColName"] == a) return _Self.ColInfo[c] } else for (c = 0; c < _Self.ColInfoRecList.length; c++) if (_Self.ColInfoRecList[c]["ColName"] == a) return _Self.ColInfoRecList[c]; return null }, this.GetDom = function (a) { return $(_Self.GetSelector(a)) }
};