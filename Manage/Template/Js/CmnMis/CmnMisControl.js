CmnMis_UI_Control_Version = "2.4", "undefined" == typeof CmnMis && (CmnMis = {}), CmnMis.UI || (CmnMis.UI = {}), function (a) { CmnMis.UI.Control = { Selector: { Container: ".cmn-Ctl-Container", ColNameContainer: ".cmn-Ctl-ColNameContainer", ColName: ".cmn-Ctl-ColName", ColIsRequired: ".cmn-Ctl-ColIsRequired", CtlContent: ".cmn-Ctl-Content", CtlTipContainer: ".cmn-Ctl-TipContainer", CtlVerifyContainer: ".cmn-Ctl-VerifyContainer", CtlVerifyRight: ".cmn-Ctl-VerifyRight", CtlVerifyError: ".cmn-Ctl-VerifyError", CtlErrTipDesc: ".cmn-Ctl-TipErrDesc", CtlTipDesc: ".cmn-Ctl-TipDesc" }, CtlLayoutTemplete: [], CustomControlPath: "CmnControl/", CustomControlCache: {}, NewControl: function (b, c, d) { var j, k, l, m, e = null, f = b, g = CmnMis.UI.Control[b], h = c, i = a.IsType(d, "string") ? $.parseJSON(d) : d; return arguments.length < 3 ? (alert("创建控件错误！参数个数不对！"), void 0) : (Cmn.IsType(g, "function") ? e = new g(h, i) : (j = CmnMis.UI.Control.CustomControlCache[f], CmnAjax.GetFile(CmnMis.UI.Control.CustomControlPath + f + "/" + f + ".js"), g = CmnMis.UI.Control[f], Cmn.IsType(g, "function") ? (e = new g(h, i), !j && e.IsExistHtmlTemp && (j = CmnAjax.GetFile(CmnMis.UI.Control.CustomControlPath + f + "/" + f + ".htm"), Cmn.IsType(j, "string") && "" != j ? (k = $("<div style='display:none;'>" + j + "</div>"), l = k.find("link").remove(), m = k.find("style").remove(), $("body").append(k), m.each(function () { $(this).insertAfter($("head style").last()) }), l.each(function () { var a = $(this).attr("href"); $(this).insertAfter($("head link").last()), $(this)[0].href = CmnMis.UI.Control.CustomControlPath + f + "/" + a }), j = k.html(), k.remove()) : (Cmn.DebugLog("创建控件的时候控件的html模板文件没找到！"), j = "")), "" != j && (CmnMis.UI.Control.CustomControlCache[f] = j)) : e = new CmnMis.UI.Control.Text(h, i)), null == e && (e = new CmnMis.UI.Control.Text(h, i)), e) }, CreateControls: function (b) { var c, d, e, f, g, h, i, j, k, l, m; if (!b.ColInfo) return !1; if (c = $(b.GetSelector(b.Selector.EditControlPanel)), d = this, e = !1, f = 0, g = 0, !(c.length <= 0)) { for (null != b.EditTemplateFileName && "" != b.EditTemplateFileName && void 0 != b.EditTemplateFileName && (e = !0), h = 0; h < b.ColInfo.length; h++) i = b.ColInfo[h], j = null, "1" == i.IsShowInEdit && (i.ControlCfg ? a.IsType(i.ControlCfg, "string") && (i.ControlCfg = $.parseJSON(i.ControlCfg)) : i.ControlCfg = {}, j = d.NewControl(i.ColControlName, i.ColName, i.ControlCfg), j.AppendTo(c), j.InitControl(), e || (b.KeyColName == i.ColName && (j.SetEnabled(!1), j.ControlCfg.IsRequired = "0"), j.SetColDesc(i.ColTitle), k = 0, l = 0, m = j.ControlCfg.Layout, m && (m.Left || m.Top) ? (m.Top && (l = 1 * m.Top), m.Left && (k = 1 * m.Left), j.SetPosition(k, l), g < l + j.ControlCfg.Height && (g = l + 1 * j.ControlCfg.Height)) : f += 20 + 1 * j.ControlCfg.Height)); c.height(Math.max(f + 30, g + 30)) } }, SetValueList: function (a, b, c) { var d = this; $(a).find(this.Selector.Container).each(function () { var f, a = d.GetControl($(this)), e = a.KeyName; if (void 0 != a) { a.IsSetValByKey && void 0 != c && (e = c.KeyColName); for (f in b) if (f == e) { a.SetValue(b[f]); break } } else Cmn.Log("在设置值的时候，找不到name为" + e + "的控件") }) }, GetValueList: function (a) { var b = {}, c = this, d = $(a).find(c.Selector.Container), e = d.not(d.find(CmnMis.Frame.Cfg.Selector.UserFormTemplate).find(c.Selector.Container)); return e.each(function () { var a = c.GetControl($(this)); void 0 != a && null != a ? b[a.KeyName] = a.GetValue() : Cmn.Log("在获取值列表的时候，没有找到对应的控件对象") }), b }, InitValueList: function (a) { var b = this; $(a).find(this.Selector.Container).each(function () { var a = b.GetControl($(this)); void 0 != a && null != a ? a.Init() : Cmn.Log("在获取值列表的时候，没有找到对应的控件对象") }) }, VerifyControlInput: function (a, b, c) { var g, h, d = this, e = $(a).find(d.Selector.Container), f = e.not(e.find(CmnMis.Frame.Cfg.Selector.UserFormTemplate).find(d.Selector.Container)); for (g = 0; g < f.length; g++) if (h = d.GetControl(f.eq(g)), h.VerifyInput(b, c) === !1) return !1; return !0 }, GetControl: function (a) { return $(a).data("control") }, GetControlData: function (b, c, d) { var e = b.FillSql, f = b.OptionList, g = { ExecSql: e }; return Cmn.IsType(f, "string") && "" != f && (f = $.parseJSON(f)), a.IsType(b, "string") ? (Cmn.Log("控件配置错误：controlCfg应该为json数组而不是字符串"), void 0) : Cmn.IsType(f, "array") && f.length > 0 ? (d && d(f), void 0) : (c && (g["where"] = c), a.IsType(b.FillSql, "string") && "" != b.FillSql ? CmnAjax.PostData(InterfaceUrl + "?method=ExecSql", g, function (a) { d && d(a.data) }) : d && d([]), void 0) } } }(Cmn.Object, Cmn.Event), function () { var a = CmnMis.UI.Control; a.BasControl = function (b, c) { var d = this; this.ControlCfg = $.extend({ Layout: { Left: void 0, Top: void 0, DescAlign: "", DescWidth: 160, DescHeight: 33 }, Default: void 0, IsRequired: "0", RegexContent: void 0, RegexErrorMsg: void 0, ColHint: void 0 }, Cmn.IsType(c, "string") ? $.parseJSON(c) : c), this.ControlDom = $("<div>").addClass(Cmn.Str.GetSelectorName(CmnMis.UI.Control.Selector.Container)).css({ position: "relative", padding: "5px 0px" }), this.ControlCfg.RegexErrorMsg = "【" + this.ControlCfg.ColTitle + " ， " + this.ControlCfg.RegexErrorMsg || "录入数据有误！】", this.ControlDom.find(a.Selector.CtlTipDesc).hide(), this.CfgDescCfg = { Width: { Type: "Text", Desc: "控件宽度", Val: "260" }, Height: { Type: "Text", Desc: "控件高度", Val: "33" }, DescHeight: { Type: "Text", Desc: "控件描述的高度", Val: "33", Parent: "Layout" }, Default: { Type: "Text", Desc: "默认值" } }, this.KeyName = b, this.Type = "BasControl", this.IsExistHtmlTemp = !1, this.IsSetValByKey = !1, this.OnChange = new Cmn.Event(this), this.OnFocus = new Cmn.Event(this), this.OnBlur = new Cmn.Event(this), this.OnKeydown = new Cmn.Event(this), this.OnKeyup = new Cmn.Event(this), this.OnFocus.Add(function () { if (this.ControlCfg.ColHint) { var b = this.ControlDom.find(a.Selector.CtlTipDesc); b.show(), b.html() || (b.html(" * " + this.ControlCfg.ColHint), b.css({ top: (this.ControlDom.height() - b.height()) / 2 })) } }, "cmn-Frame-Control-Focus"), this.OnBlur.Add(function () { this.ControlCfg.ColHint && this.ControlDom.find(a.Selector.CtlTipDesc).hide() }, "cmn-Frame-Control-Blur"), this.CreateHtml = function () { var b = this.GetInitHtml(), c = '<div style="width:100%;height:100%;position:relative;"><div class="cmn-Ctl-TipDesc" style="width: 100%;  position: absolute;left:100%; text-align: left; color: #F7573A;"></div><div style="width:100%;height:100%;"><div class="cmn-Ctl-ColNameContainer" style="padding-right: 10px;width: 35%; height: 100%; float: left; zoom: 1;  font-size: 16px; color: #505050; line-height: 30px; text-align: right; "><span class="cmn-Ctl-ColIsRequired" style="color: #F7573A;">*</span><span class="cmn-Ctl-ColName">:</span></div><div class="cmn-Ctl-Content" style="width: 62%; height: 100%; float: left; zoom: 1; border-radius: 5px; ">' + (b || "") + "</div>" + "</div>" + "</div>"; $(b).hasClass(Cmn.Str.GetSelectorName(a.Selector.Container)) ? this.ControlDom = $(b) : (this.ControlDom.find(a.Selector.CtlContent).length > 0 ? this.ControlDom.find(a.Selector.CtlContent).html() ? this.ControlDom.find(".cmn-control").html() || this.ControlDom.find(".cmn-control").append(b) : this.ControlDom.find(a.Selector.CtlContent).append(b) : this.ControlDom.empty().append(c), this.ControlDom.find(a.Selector.ColNameContainer).css({ height: this.ControlCfg.Layout.DescHeight + "px", width: 1 * this.ControlCfg.Layout.DescWidth - 10 + "px", "line-height": (this.ControlCfg.Layout.DescHeight || this.ControlCfg.Height) + "px" }), this.ControlDom.find(a.Selector.CtlContent).css({ width: 1 * this.ControlCfg.Width - 10 + "px", height: this.ControlCfg.Height + "px", "line-height": this.ControlCfg.Height + "px" }), this.ControlDom.css({ width: 1 * this.ControlCfg.Layout.DescWidth + 1 * this.ControlCfg.Width, height: this.ControlCfg.Height })), "1" != this.ControlCfg.IsRequired ? this.ControlDom.find(a.Selector.ColIsRequired).hide() : this.ControlDom.find(a.Selector.ColIsRequired).show(), this.ControlDom.attr("data-control-type", this.Type), this.ControlDom.attr("name", this.KeyName) }, this.GetInitHtml = function () { return a.CustomControlCache[this.Type] }, this.SetCfgDescCfg = function (a) { Cmn.IsType(a, "object") && ($.each(a, function (b) { d.CfgDescCfg[b] && (d.CfgDescCfg[b] = a[b], a[b] = void 0) }), d.CfgDescCfg = Cmn.Extend(a, d.CfgDescCfg)) }, this.AppendTo = function (b) { this.CreateHtml(); var c = $(b).find(a.Selector.Container + "[name=" + this.KeyName + "]"); c.length <= 0 && (c = $(b).find(".cmn-control[name=" + this.KeyName + "]").parents(a.Selector.Container)), c.length <= 0 ? $(b).append(this.ControlDom) : this.ControlDom = c, this.ControlDom.data("control", this) }, this.SetColDesc = function (b) { b || (b = this.KeyName), this.ControlDom.find(a.Selector.ColName).html(b + " : ") }, this.InitControl = function () { }, this.ReLoadData = function () { }, this.InitControlConfig = function (a) { var b = this.ControlDom.attr("cg-ctl-cfg") || this.ControlDom.attr("control-config"); return Cmn.IsType(b, "string") && (b = $.parseJSON(b), b["Default"] || (b["Default"] = void 0)), a ? (Cmn.IsType(a, "string") && (a = $.parseJSON(a)), $.each(a, function (b) { a[b] || 0 == a[b] || "Default" == b || (a[b] = void 0) })) : a = {}, $.each(d.CfgDescCfg, function (b) { Cmn.IsType(d.CfgDescCfg[b], "object") && !a[b] && "Default" != b && (a[b] = Cmn.IsType(d.CfgDescCfg[b].Val, "array") ? d.CfgDescCfg[b].Val[0]["key"] : d.CfgDescCfg[b].Val) }), this.ControlCfg = Cmn.Extend(b, a), this.ControlCfg }, this.VerifyInput = function (b, c) { var d = this, e = "", f = Cmn.Func.GetNoHTMLFormatStr(d.GetValue()), g = !0, h = ""; if ("1" == d.ControlCfg.IsRequired && (e = /\S/, f || (f = ""), e.test($.trim(f)) || (h = d.ControlCfg.ColTitle + " : " + "为必填项！", g = !1)), e = d.ControlCfg.RegexContent, e && g) { if (!Cmn.IsType(e, "string")) return console.error(e.toString() + "正则表达式类型不对！"), !0; "/" == e[0] && (e = e.substr(1, e.length - 2)), e = new RegExp(e), f || (f = ""), e.test($.trim(f)) || (g = !1, h = d.ControlCfg.RegexErrorMsg) } return g ? (d.ControlDom.find(a.Selector.CtlVerifyRight).show(), d.ControlDom.find(a.Selector.CtlVerifyError).hide(), $(b).hide().html(""), !0) : (d.ControlDom.find(a.Selector.CtlVerifyError).show(), d.ControlDom.find(a.Selector.CtlVerifyRight).hide(), d.ControlDom.find(a.Selector.CtlErrTipDesc).html(h), d.ControlDom.find(a.Selector.CtlErrTipDesc).show(), d.ControlDom.find(a.Selector.CtlTipDesc).hide(), $(b).show().html(h), c && c.call(d, $.extend(new Cmn.ErrMsg(h), { control: d })), !1) }, this.Init = function () { this.SetValue("") }, this.GetValue = function () { }, this.SetValue = function () { }, this.SetWidth = function (a) { this.ControlDom.css({ width: a }) }, this.SetHeight = function (a) { this.ControlDom.css({ height: a }) }, this.SetPosition = function (a, b) { this.ControlDom.css({ left: a, top: b, position: "absolute" }) }, this.SetEnabled = function (a) { a ? this.ControlDom.find("input").attr("disabled", !1) : this.ControlDom.find("input").attr("disabled", !0) }, this.SetFocus = function () { this.ControlDom.find("input").focus() } }, a.Text = function (b, c) { Cmn.Object.Inherit(this, a.BasControl, [b, c]); var d = this; d.Type = "Text", d.KeyName = b, d.ControlCfg = d.InitControlConfig(Cmn.Extend(d.ControlCfg, c)), d.GetInitHtml = function () { return '<input type="text" style="width:100%;height:100%;border:none;" />' }, d.InitControl = function () { d.ControlDom.find(a.Selector.CtlContent).css({ border: " 1px solid #e6e6e6" }), d.ControlDom.find("input").focus(function () { d.OnFocus.Trigger([this]) }), d.ControlDom.find("input").blur(function () { d.OnBlur.Trigger([this]) }), d.ControlDom.find("input").change(function () { d.OnChange.Trigger([this]) }), d.ControlDom.find("input").keydown(function () { d.OnKeydown.Trigger([this]) }), d.ControlDom.find("input").keyup(function () { d.OnKeyup.Trigger([this]) }) }, d.GetValue = function () { return this.ControlDom.find("input").val() }, d.SetValue = function (a) { this.ControlDom.find("input").val(a) } }, a.Sort = function (b, c) { Cmn.Object.Inherit(this, a.Text, [b, c]), this.Type = "Sort" }, a.Hidden = function (b, c) { Cmn.Object.Inherit(this, a.Text, [b, c]), this.Type = "Hidden", this.GetInitHtml = function () { return '<input type="hidden" style="width:96%;height:76%;margin:1%;padding:1%;border:none;" />' }, this.InitControl = function () { this.ControlDom.hide() } }, a.Password = function (b, c) { Cmn.Object.Inherit(this, a.Text, [b, c]), this.Type = "Password", this.GetInitHtml = function () { return '<input type="password" style="width:96%;height:76%;margin:1%;padding:1%;border:none;" />' } }, a.Select = function (b, c) { var d, e; Cmn.Object.Inherit(this, a.BasControl, [b, c]), d = this, d.Type = "Select", d.SetCfgDescCfg({ FillSql: { Type: "TextArea", Desc: "数据sql" }, OptionList: { Type: "TextArea", Desc: "数据集" }, LinkControlName: { Type: "Text", Desc: "联动字段名称" } }), d.ControlCfg = d.InitControlConfig(Cmn.Extend(d.ControlCfg, c)), e = function (a) { var b = d.ControlDom.find("select").empty(); "0" == d.ControlCfg.IsRequired && b.append($("<option value=''></option>")), CmnMis.UI.Control.GetControlData(d.ControlCfg, a, function (a) { var c = a, e = ""; c && (Cmn.IsType(c, "string") && (c = $.parseJSON(c)), $.each(c, function (a, b) { var c = "", d = "", f = 0; return Cmn.IsType(b, "object") ? ($.each(b, function (a, b) { if (0 == f) c = b; else { if (1 != f) return; d = b } f++ }), e += '<option value="' + c + '">' + d + "</option>", void 0) : (Cmn.Log("OptionList : 数据格式违法！必须为json数组"), void 0) })), b.append($(e)), d.Init(), d.ControlDom.find("select").data("setValue") && (d.SetValue(d.ControlDom.find("select").data("setValue")), d.ControlDom.find("select").data("setValue", void 0)) }) }, d.GetInitHtml = function () { return "<select style = 'width:100%;height:100%;border:none;' ><select/>" }, d.InitControl = function () { var b = d.ControlDom.find("select"); d.ControlDom.find(a.Selector.CtlContent).css({ border: " 1px solid #e6e6e6" }), e(), b.off("change").on("change", function () { if (d.ControlCfg.LinkControlName && Cmn.IsType(d.ControlCfg.LinkControlName, "string")) { var a = "[" + d.KeyName + "]", b = a + "=" + $(this).val(), c = d.ControlDom.siblings(control.Selector.Container).find(control.Selector.CtlContent + "[name=" + d.ControlCfg.LinkControlName + "]").parents(control.Selector.Container), e = CmnMis.UI.Control.GetControl(c); e && e.ReLoadData(b) } d.OnChange.Trigger([d.GetValue()]) }) }, d.ReLoadData = function (a) { e(a) }, d.Init = function () { this.SetValue(0), this.ControlCfg.Default && this.SetValue(this.ControlCfg.Default) }, d.SetValue = function (a) { this.ControlDom.find("select").data("setValue", a), this.ControlDom.find("select").val(a) }, this.GetValue = function () { return this.ControlDom.find("select").val() }, d.SetEnabled = function (a) { a ? this.ControlDom.find("select").attr("disabled", !1) : this.ControlDom.find("select").attr("disabled", !0) }, d.SetFocus = function () { this.ControlDom.find("select").focus() } }, a.CheckBox = function (b, c) { var d, e; Cmn.Object.Inherit(this, a.BasControl, [b, c]), d = this, d.Type = "CheckBox", d.SetCfgDescCfg({ FillSql: { Type: "TextArea", Desc: "数据sql" }, OptionList: { Type: "TextArea", Desc: "数据集" }, LinkControlName: { Type: "Text", Desc: "联动字段名称" } }), d.ControlCfg = d.InitControlConfig(Cmn.Extend(d.ControlCfg, c)), e = function (b) { var c = d.ControlDom.find(a.Selector.CtlContent).empty(); CmnMis.UI.Control.GetControlData(d.ControlCfg, b, function (a) { var b = a, e = ""; b && (Cmn.IsType(b, "string") && (b = $.parseJSON(b)), $.each(b, function (a, b) { var c = "", f = "", g = 0; return Cmn.IsType(b, "object") ? ($.each(b, function (a, b) { if (0 == g) c = b; else { if (1 != g) return; f = b } g++ }), e += '<label style=\'cursor: pointer;\'><input type="checkbox" name="' + d.KeyName + '"  value="' + c + "\" style='width:auto;height:auto;vertical-align: middle;' />" + "<b style='margin-right: 10px;'>" + f + "</b></label>", void 0) : (Cmn.Log("OptionList : 数据格式违法！必须为json数组"), void 0) })), c.append($(e)), d.Init(), d.ControlDom.find("select").data("setValue") && (d.SetValue(d.ControlDom.find("select").data("setValue")), d.ControlDom.find("select").data("setValue", void 0)) }) }, d.InitControl = function () { var b = d.ControlDom.find(a.Selector.CtlContent); e(), b.find("input").off("click").on("click", function () { if (d.ControlCfg.LinkControlName && Cmn.IsType(d.ControlCfg.LinkControlName, "string")) { var a = "[" + d.KeyName + "]", b = a + "=" + $(this).val(), c = d.ControlDom.siblings(control.Selector.Container).find(control.Selector.CtlContent + "[name=" + d.ControlCfg.LinkControlName + "]").parents(control.Selector.Container), e = CmnMis.UI.Control.GetControl(c); e && e.ReLoadData(b) } d.OnChange.Trigger([d.GetValue()]) }) }, d.ReLoadData = function (a) { e(a) }, d.Init = function () { this.ControlDom.find("input").attr("checked", !1), this.ControlCfg.Default && this.SetValue(this.ControlCfg.Default) }, d.SetValue = function (a) { "1" == a ? this.ControlDom.find("input").attr("checked", "checked") : "0" == a && this.ControlDom.find("input").attr("checked", !1) }, d.GetValue = function () { return d.ControlDom.find("input:checked").val() } }, a.RadioButton = function (b, c) { var d, e; Cmn.Object.Inherit(this, a.BasControl, [b, c]), d = this, d.Type = "RadioButton", d.SetCfgDescCfg({ FillSql: { Type: "TextArea", Desc: "数据sql" }, OptionList: { Type: "TextArea", Desc: "数据集" }, LinkControlName: { Type: "Text", Desc: "联动字段名称" } }), d.ControlCfg = d.InitControlConfig(Cmn.Extend(d.ControlCfg, c)), e = function (b) { var c = d.ControlDom.find(a.Selector.CtlContent).empty(); CmnMis.UI.Control.GetControlData(d.ControlCfg, b, function (a) { var b = a, e = ""; b && (Cmn.IsType(b, "string") && (b = $.parseJSON(b)), $.each(b, function (a, b) { var c = "", f = "", g = 0; return Cmn.IsType(b, "object") ? ($.each(b, function (a, b) { if (0 == g) c = b; else { if (1 != g) return; f = b } g++ }), e += '<label style=\'cursor: pointer;\'><input type="radio" name="' + d.KeyName + '"  value="' + c + "\"  style='width:auto;height:auto;vertical-align: middle;' />" + "<b style='margin-right: 10px;'>" + f + "</b><label>", void 0) : (Cmn.Log("OptionList : 数据格式违法！必须为json数组"), void 0) })), c.append($(e)), d.Init(), d.ControlDom.find("select").data("setValue") && (d.SetValue(d.ControlDom.find("select").data("setValue")), d.ControlDom.find("select").data("setValue", void 0)) }) }, d.InitControl = function () { var b = d.ControlDom.find(a.Selector.CtlContent); e(), b.find("input").off("click").on("click", function () { if (d.ControlCfg.LinkControlName && Cmn.IsType(d.ControlCfg.LinkControlName, "string")) { var a = "[" + d.KeyName + "]", b = a + "=" + $(this).val(), c = d.ControlDom.siblings(control.Selector.Container).find(control.Selector.CtlContent + "[name=" + d.ControlCfg.LinkControlName + "]").parents(control.Selector.Container), e = CmnMis.UI.Control.GetControl(c); e && e.ReLoadData(b) } d.OnChange.Trigger([d.GetValue()]) }) }, d.ReLoadData = function (a) { e(a) }, d.Init = function () { this.ControlDom.find("input").attr("checked", !1), this.ControlCfg.Default && this.SetValue(this.ControlCfg.Default) }, d.SetValue = function (a) { var b = !0; 2 == this.ControlDom.find("input").length && (this.ControlDom.find("input").each(function (a, c) { "1" == $(c).val() || "0" == $(c).val() || (b = !1) }), !b || "True" != a && "False" != a || (a = "True" == a ? "1" : "0")), this.ControlDom.find("input").each(function (b, c) { $(c).val() == a && $(c).attr("checked", "checked") }) }, d.GetValue = function () { return d.ControlDom.find("input:checked").val() } }, a.TextArea = function (b, c) { Cmn.Object.Inherit(this, a.BasControl, [b, c]); var d = this; d.Type = "TextArea", d.SetCfgDescCfg({ Height: { Type: "Text", Desc: "控件高度", Val: "50" } }), d.ControlCfg = d.InitControlConfig(Cmn.Extend(d.ControlCfg, c)), d.GetInitHtml = function () { return "<textarea style = 'width:100%;height:100%' /></textarea>" }, d.InitControl = function () { d.ControlDom.find(a.Selector.CtlContent).css({ border: " 1px solid #e6e6e6" }), d.ControlDom.find("textarea").focus(function () { d.OnFocus.Trigger([this]) }), d.ControlDom.find("textarea").blur(function () { d.OnBlur.Trigger([this]) }) }, d.GetValue = function () { return this.ControlDom.find("textarea").val() }, d.SetValue = function (a) { this.ControlDom.find("textarea").val(a) }, d.SetEnabled = function (a) { a ? this.ControlDom.find("textarea").attr("disabled", !1) : this.ControlDom.find("textarea").attr("disabled", !0) }, d.SetFocus = function () { this.ControlDom.find("textarea").focus() } }, a.Label = function (b, c) { Cmn.Object.Inherit(this, a.BasControl, [b, c]); var d = this; d.Type = "Label", d.GetInitHtml = function () { return "<label class='cmn-ctl-label' style = 'width:100%;height:100%;dispaly:block' /></label>" }, d.InitControl = function () { d.ControlDom.find(a.Selector.CtlContent).css({ border: " 1px solid #e6e6e6" }) }, d.GetValue = function () { return this.ControlDom.find(".cmn-ctl-label").val() }, d.SetValue = function (a) { this.ControlDom.find(".cmn-ctl-label").val(a) }, d.SetFocus = function () { this.ControlDom.find(".cmn-ctl-label").focus() } }, a.DateSelect = function (b, c) { Cmn.Object.Inherit(this, a.Text, [b, c]); var d = this; this.Type = "DateSelect", d.SetCfgDescCfg({ DateType: { Type: "RadioButton", Desc: "数据类型", Val: [{ key: "date", val: "日期" }, { key: "datetime", val: "日期时间" }] } }), d.ControlCfg = d.InitControlConfig(Cmn.Extend(d.ControlCfg, c)), d.InitControl = function () { d.ControlDom.find(a.Selector.CtlContent).css({ border: " 1px solid #e6e6e6" }), d.ControlDom.find("input"), "datetime" == d.ControlCfg.DateType ? "function" == typeof d.ControlDom.find("input").datetimepicker && d.ControlDom.find("input").datetimepicker({ numberOfMonths: 1, showSecond: !0, showMillisec: !0, timeFormat: "hh:mm:ss" }) : d.ControlDom.find("input").datepicker({ dateFormat: "yy-mm-dd", altField: d.ControlDom }) } }, a.DetailUserForm = function (b, c) { var d, e; Cmn.Object.Inherit(this, a.BasControl, [b, c]), d = this, d.Type = "DetailUserForm", d.IsSetValByKey = !0, d.SetCfgDescCfg({ UserFormID: { Type: "TextArea", Desc: "表单代码" }, MainKeyFieldName: { Type: "Text", Desc: "主键字段名称" }, ForeignKeyFieldName: { Type: "Text", Desc: "外键字段名称" }, IsOneToOne: { Type: "RadioButton", Desc: "是否是1对1关系", Val: [{ key: "1", val: "是" }, { key: "0", val: "否" }] }, Width: { Type: "Hidden", Desc: "控件高度", Val: "750" }, Height: { Type: "Text", Desc: "控件高度", Val: "250" } }), d.ControlCfg = d.InitControlConfig(Cmn.Extend(d.ControlCfg, c)), d.CreateEditForm = function (a) { $(a.GetSelector(".RightContentWrap")).addClass("DetailedFormWrap") }, d.BindUserFormEvent = function (a, b) { var c, e; a.OnAddInitComplete.Add(function () { var c = a.GetControlByName(d.ControlCfg.ForeignKeyFieldName); null != c && (c.SetValue(b), c.SetEnabled(!1)), $(a.GetSelector(".AddMenuBtn")).show() }), c = $(a.GetSelector()).parent(), c.find(".DetailedFormWrap").off("scroll").on("scroll", function () { c.find(".DetailedFormWrap").find(".DetailFormMask").css("top", c.find(".DetailedFormWrap").scrollTop() + "px") }), a.OnUpdateInitComplete.Add(function () { $(a.GetSelector(".AddMenuBtn")).show() }), a.BeforeGetRecList.Add(function () { $(a.GetSelector(".AddMenuBtn")).hide() }), a.OnCancel.Add(function () { $(a.GetSelector(".AddMenuBtn")).hide(), $(".CloseDetailedFormPopBtn").click() }), a.AfterAddSave.Add(function () { $(".CloseDetailedFormPopBtn").click() }), a.AfterUpdateSave.Add(function () { $(".CloseDetailedFormPopBtn").click() }), a.OnAddClick.Add(function () { e(this, c) }), a.OnUpdateClick.Add(function () { e(this, c) }), e = function (a, b) { var c = b.width(), d = b.height(); b.addClass("DetailedFormPopWrap"), b.width("100%"), b.height("100%"), $(".CloseDetailedFormPopBtn").show(), b.find(".DetailedFormWrap").find(".DetailFormMask").hide(), $(".CloseDetailedFormPopBtn").bind("click", function () { $(this).unbind("click"), b.removeClass("DetailedFormPopWrap"), b.width(c), b.height(d), $(".CloseDetailedFormPopBtn").hide(), b.find(".DetailedFormWrap").find(".DetailFormMask").show(), b.find(".AddMenuBtn").hide(), a.ShowViewState(a.Cfg.ViewState.RecList, !0) }) } }, e = function (a) { function c(a, b) { if ($(a.GetSelector(".RightContentWrap")).addClass("DetailedFormWrap"), a.InitUserForm(), d.BindUserFormEvent(a, b), $(a.GetSelector(".AddMenuBtn")).hide(), $(a.GetSelector(".ConfigurationFormBtn")).hide(), $(a.GetSelector(".SearchWrap")).hide(), $(a.GetSelector(".FilterSelect")).hide(), $(a.GetSelector(".FindRangeWrap")).hide(), $(a.GetSelector(".jscDetailUserFormDesc")).length <= 0) { var c = d.ControlDom.find(".jscDetailUserFormDesc").clone(); c.css({ "margin-left": "2%", height: " 30px", "font-size": "16px", "line-height": "30px", "float": "left", display: "inline-block" }).show().insertAfter($(a.GetSelector(".FilterSelect"))) } $(a.GetSelector(".cmn-EditPanel")).css({ height: .7 * $(window).height() - 70 }), d.CreateEditForm(a) } if ("" != a) { var b = CmnMis.Func.GetDetailUserFormInfoByID(d.ControlCfg.UserFormID); b.SetFixedCondition("[" + d.ControlCfg.ForeignKeyFieldName + "]='" + a + "'"), null != b.TableCache ? b.TableCache.Init(b, d.ControlCfg.ForeignKeyFieldName, a, function () { c(b, a) }) : c(b, a) } }, d.CreateHtml = function () { var b = '<div style="width:100%;height:100%;position:relative;"><div class="cmn-Ctl-ColNameContainer" style="padding-right: 10px;width: 35%; height: 100%; float: left; zoom: 1;  font-size: 16px; color: #505050; line-height: 30px; text-align: right; "><span class="cmn-Ctl-ColName jscDetailUserFormDesc" style="display:none;">:</span></div><div class="cmn-Ctl-Content" style="width: 100%;float: left; height: 100%; zoom: 1; border-radius: 5px; ">' + "<div class='cmn-UserFormTemplate' style='height:100%;'  name='cmn-UserForm" + d.ControlCfg.UserFormID + "_" + CmnMis.CurUserForm.UserFormID + "'></div>" + "</div>" + "</div>"; d.ControlDom.empty().append(b), d.ControlDom.attr("data-control-type", d.Type), d.ControlDom.attr("name", d.KeyName), this.ControlDom.find(a.Selector.ColNameContainer).css({ height: this.ControlCfg.Layout.DescHeight + "px", width: 1 * this.ControlCfg.Layout.DescWidth - 10 + "px", "line-height": (this.ControlCfg.Layout.DescHeight || this.ControlCfg.Height) + "px" }), this.ControlDom.find(a.Selector.CtlContent).css({ width: 1 * this.ControlCfg.Width - 10 + "px", height: this.ControlCfg.Height + "px", "line-height": this.ControlCfg.Height + "px" }), this.ControlDom.css({ width: 1 * this.ControlCfg.Layout.DescWidth + 1 * this.ControlCfg.Width, height: this.ControlCfg.Height }) }, d.InitControl = function () { d.ControlDom.find(a.Selector.CtlContent).css({ border: " 1px solid #e6e6e6" }) }, d.Init = function () { e("99999999") }, d.GetValue = function () { var a = CmnMis.Func.GetDetailUserFormInfoByID(d.ControlCfg.UserFormID); return Cmn.Func.JsonToStr(a.TableCache.GetChangeRecList()) }, d.SetValue = function (a) { setTimeout(function () { e(a) }, 500) } }, a.DetailMultiCheckbox = function (b, c) { Cmn.Object.Inherit(this, a.BasControl, [b, c]); var d = this; d.Type = "DetailMultiCheckbox", d.IsSetValByKey = !0, d.SelectDataKeyField = "", d.SaveKeyField = "", d.ForeignKeyValue = "", d.CfgDescCfg = { FillSql: { type: "TextArea", desc: "sql" }, SaveTableName: { type: "Text", desc: "保存数据的表名" }, ForeignKeyFieldName: { type: "Text", desc: "外键名称" }, Width: { type: "Text", desc: "控件宽度" }, ItemWidth: { type: "Text", desc: "每个选项的宽度" }, Height: { type: "Text", desc: "控件高度" } }, d.GetInitHtml = function () { return "<div class='cmn-DetailMultiCheckbox' style='width:100%;height:100%;text-align:left;' name='dmc-" + this.KeyName + "'></div>" }, d.InitControl = function () { CmnMis.UI.Control.GetControlData(this.ControlCfg, "", function (a) { var b, c, e, f, g; if (a.length > 0) { b = "", c = 0; for (e in a[0]) 0 == c ? d.SelectDataKeyField = e : 1 == c && (b = e), c++; for (f = d.ControlCfg["ItemWidth"] || "100", g = 0; g < a.length; g++) d.ControlDom.find(".cmn-DetailMultiCheckbox").append("<div style='display: inline-block;*display:inline;zoom:1; width:" + f + "px;vertical-align:middle;margin:auto 5px;'><input type='checkbox' style='width:auto; vertical-align:middle;display:inline-block;'  value='" + a[g][d.SelectDataKeyField] + "' id='" + d.KeyName + "_" + a[g][d.SelectDataKeyField] + "' /><label style='width:" + (f - 20) + "px;vertical-align:middle;display:inline-block;line-height:13px;word-break:break-all;word-wrap:break-word;' for='" + d.KeyName + "_" + a[g][d.SelectDataKeyField] + "'>" + a[g][b] + "</label></div>"); d.ControlDom.find(".cmn-DetailMultiCheckbox").parent().css("height", "auto").parent().css("height", "auto") } }) }, d.Init = function () { this.ControlDom.find("input[type=checkbox]").attr("checked", !1), this.ControlDom.find("input[type=checkbox]").attr("OldValue", "") }, d.GetValue = function () { var a = new Array; return this.ControlDom.find("input[type=checkbox]").each(function () { var b; "1" == $(this).attr("OldValue") ? "checked" != $(this).attr("checked") && (b = {}, b[d.SaveKeyField] = $(this).attr(d.SaveKeyField), b["CmnOpt"] = "Delete", a[a.length] = b) : "checked" == $(this).attr("checked") && (b = {}, b[d.SelectDataKeyField] = $(this).val(), b[d.ControlCfg["ForeignKeyFieldName"]] = d.ForeignKeyValue, b["CmnOpt"] = "Add", a[a.length] = b) }), Cmn.Func.JsonToStr(a) }, d.SetValue = function (a) { _self.ForeignKeyValue = a, CmnMis.TableOpt.GetData(d.ControlCfg["SaveTableName"], { Condition: "[GoodsID]='" + a + "'" }, !1, function (a) { var b, c, e; if (a.data.length > 0) { for (b in a.data[0]) { d.SaveKeyField = b; break } for (c = 0; c < a.data.length; c++) e = d.ControlDom.find("#" + d.KeyName + "_" + a.data[c][d.SelectDataKeyField]), e.length > 0 && (e.attr("checked", "checked"), e.attr("OldValue", "1"), e.attr(d.SaveKeyField, a.data[c][d.SaveKeyField])) } }) } }, a.EditExd = function (b, c) { Cmn.Object.Inherit(this, a.BasControl, [b, c]); var d = this; d.Type = "EditExd", d.IsSetValByKey = !0, d.CfgDescCfg = { Width: { type: "text", desc: "控件宽度" }, Height: { type: "text", desc: "控件高度" } } } }();