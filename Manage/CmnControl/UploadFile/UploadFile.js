CmnMis_UI_Control_FileUpload_Version = "2.2.2", function (a, b) { a.UploadFile = function (c, d) { b.Inherit(this, a.BasControl, [c, d]); var e = this; e.Type = "UploadFile", e.IsExistHtmlTemp = !0, e.SetCfgDescCfg({ ItfUrl: { Type: "TextArea", Desc: "上传的接口地址", Val: "Itf/CSharp/Upload.aspx" }, SavePath: { Type: "Text", Desc: "上传保存的路径", Val: "/Upload" }, FileType: { Type: "RadioButton", Desc: "上传控件类型", Val: [{ key: "image", val: "图片上传" }, { key: "file", val: "文件上传" }] }, FileExt: { Type: "TextArea", Desc: "上传文件限制后缀", Val: "jpg,jpeg,png,gif,bmp" }, IsSaveRealFileName: { Type: "RadioButton", Desc: "是否保存真实文件名称", Val: [{ key: "0", val: "否" }, { key: "1", val: "是" }] } }), e.ControlCfg = e.InitControlConfig(Cmn.Extend(e.ControlCfg, d)), e.SelectComplete = function () { }, e.OnFilter = function () { }, e.OnComplete = function () { }, e.OnClickDelBtn = function () { }, e.InitControl = function () { Cmn.UI && Cmn.UI.BasPlugin || CmnAjax.Func.LoadJs(Cmn.Func.GetRoot() + "Js/CmnUI/CmnUI.js"), Cmn.UI && Cmn.UI.FileUpload || CmnAjax.Func.LoadJs(Cmn.Func.GetRoot() + "Js/CmnUI/FileUpload/FileUpload.js"), e.ControlCfg.ItfUrl && (e.ControlCfg.ItfUrl = e.ControlCfg.ItfUrl.indexOf("method=") > 1 ? e.ControlCfg.ItfUrl : e.ControlCfg.ItfUrl + "?method=File"), e.ControlDom.css({ height: "auto" }).find(CmnMis.UI.Control.Selector.CtlContent).css({ height: "auto", border: "none", "text-align": "left" }), e.fileUpload = Cmn.UI.FileUpload(e.ControlDom.find(".cg-Ctl-UploadFileContainer"), e.ControlCfg.ItfUrl, !0), e.fileUpload.LimitFileSuffix = e.ControlCfg.FileExt ? e.ControlCfg.FileExt.split(",") : e.fileUpload.LimitFileSuffix, e.fileUpload.LimitSize = 1048576 * (parseInt(e.ControlCfg.FileSize) || 3), e.fileUpload.Data = { limitSize: e.fileUpload.LimitSize / 1048576, rootPath: e.ControlCfg.SavePath, suffix: e.fileUpload.LimitFileSuffix.toString(), isSaveRealFileName: e.ControlCfg.IsSaveRealFileName }, e.fileUpload.SelectComplete = function () { e.ControlDom.find(".cg-Ctl-FileViewContainer").show(), e.ControlDom.find(".cg-Ctl-ProgressContainer").show(), e.SelectComplete() }, e.fileUpload.OnFilter = function (b) { b.state || e.ControlDom.find(".cg-Ctl-ProgressContainer").hide(), e.OnFilter(b), e.ControlDom.find(a.Selector.CtlTipDesc).show(), e.ControlDom.find(a.Selector.CtlErrTipDesc).hide().html("") }, e.fileUpload.OnComplete = function (a) { e.SetValue({ path: a.data.path }), e.OnComplete(a.data) }, e.fileUpload.OnClickDelBtn = function () { e.SetValue({ path: "" }), e.ControlDom.find(".cg-Ctl-FileViewContainer").hide(), e.ControlDom.find(".cg-Ctl-SelectFileBtn").show(), e.OnClickDelBtn() } }, e.GetValue = function () { return this.ControlDom.find(this.fileUpload.Selector.SelectFile).data("path") }, e.SetValue = function (a) { a && (b.IsType(a, "object") ? a = a.path ? a.path : "" : this.fileUpload.SetFileInfo({ path: Cmn.Func.AddSiteRoot(a) }), this.ControlDom.find(".cg-Ctl-SelectFileBtn").hide(), this.ControlDom.find(".cg-Ctl-ProgressContainer").hide(), this.ControlDom.find(".cg-Ctl-FileViewContainer").show(), this.ControlDom.find(this.fileUpload.Selector.SelectFile).data("path", a)) }, e.SetWidth = function (a) { this.ControlDom.find(this.fileUpload.Selector.SelectFile).css({ width: a }) }, e.Init = function () { this.ControlDom.find(this.fileUpload.Selector.SelectFile).data("path", ""), this.fileUpload.SetFileInfo(), this.ControlDom.find(".cg-Ctl-SelectFileBtn").show(), this.ControlDom.find(".cg-Ctl-ProgressContainer").hide(), this.ControlDom.find(".cg-Ctl-FileViewContainer").hide() } } }(CmnMis.UI.Control, Cmn.Object);