CmnMis_UI_Control_SelectFileDirectory_Version = "1.0", $(function () { var a = CmnMis.UI.Control; a.SelectFileDirectory = function (b, c) { var d, e, f, g; Cmn.Object.Inherit(this, a.BasControl, [b, c]), d = this, d.Type = "SelectFileDirectory", d.KeyName = b, e = [""], f = [], d.ControlCfg = d.InitControlConfig(Cmn.Extend(d.ControlCfg, c)), d.GetInitHtml = function () { return '<div class="ChooseGenerateList" style="width: 438px; height: 33px; float: left; zoom: 1; border-radius: 5px; line-height: 33px;"><!--生成目录--><div style="width: 438px; height: 100%;"><div class="" style="width: 260px; height: 33px; float: left; zoom: 1; border-radius: 5px; line-height: 33px; border: 1px solid rgb(230, 230, 230);"><input class="jscServerPathText" disabled="disabled" type="text" style="width:100%;height:100%;border:none; outline: none; text-indent: 5px;float: left;border-radius: 5px;z-index: 15;"><div class="jscChooseList" style="width: 70px; height: 92%; border: 1px solid #DDD; border-radius: 5px; cursor: pointer; text-align: center; position: absolute; left: 98.5%; line-height: 33px; background: #FAFAFA; color: #767474;">选择目录</div></div></div></div><div style="width:100%;height:100%;background:#e2e2e2;"><div class="ServerDirectoryWrap jscServerDirectoryWrap" style="display: none; width: 20%; position: fixed; left: 35%; top: 17%; background: #fff; height: 40%; overflow: hidden; z-index: 20; border: 1px solid #e2e2e2;"><input class="jscFolderNameText" type="text" value="" style="position: absolute;left: 1px;width: 80px; height: 19px; border: 1px solid #767474; bottom: 1%;"/><div class="jscCreateFolder" style="width: 60px; height: 18px; border: 1px solid #767474; border-radius: 5px; text-align: center;position: absolute; bottom:1%; left: 84px; background: #505050; color: #fff; cursor: pointer; ">新建文件夹</div><div class="jscReturn" style="width: 20px; height: 18px; border-radius: 5px; text-align: center; position: absolute; top: 0px; color: #000; cursor: pointer;font-size: 20px;">&lt;</div><div class="jscHide" style="line-height:18px;font-size: 20px;width: 19px; height: 18px; border-radius: 5px; text-align: center; position: absolute; right: 3px; top: 2px; color: #000; cursor: pointer; ">×</div><div class="jscFileContent" style=" width: 100%; height: 79%; position: absolute; top:10%;left:0px;border:1px solid #767474;"><ul></ul></div><div class="jscDetermine" style="padding: 0px; width: 50px; height: 20px; border: 1px solid #767474; border-radius: 5px; text-align: center; cursor: pointer; position: absolute; bottom:1%; right: 0px; background: #505050; color: #fff;">确定</div></div></div>' }, g = function (a, b) { a || (a = "/"), CmnAjax.PostData(InterfaceUrl + "?method=[Cms]Cms.Model.GetDirectoryInfoName", { DirectoryPath: a }, function (a) { if (a && a.Data) { var c = ""; $.each(a.Data, function () { "" == this.Extension && (f.push({ FileName: this.Desc }), c += '<li style="cursor: pointer;height: 15px;" class="jscFileName">[文件夹]&nbsp;<span>' + this.Desc + "</span></li>") }), d.ControlDom.find(".jscFileContent ul").html(c), b && b() } }) }, d.InitControl = function () { Cmn.UI && Cmn.UI.BasPlugin || CmnAjax.Func.LoadJs(Cmn.Func.GetRoot() + "Js/CmnUI/CmnUI.js"), Cmn.UI && Cmn.UI.Upload || CmnAjax.Func.LoadJs(Cmn.Func.GetRoot() + "Js/CmnUI/Upload/Upload.js"), d.ControlDom.find(".jscReturn").on("click", function () { if (e.length > 1) { var a = $.extend([], e); a.splice(a.length - 1, 1), g(a.join("/"), function () { e.splice(e.length - 1, 1) }) } }), d.ControlDom.undelegate(".jscFileName", "dblclick").delegate(".jscFileName", "dblclick", function () { var a = this; d.ControlDom.find(".jscFileName").find("span").removeClass("jscColor"), g(e.join("/") + "/" + $(a).find("span").text() + "/", function () { e.push($(a).find("span").text()) }) }), d.ControlDom.undelegate(".jscFileName", "click").delegate(".jscFileName", "click", function () { var a = $(this).index(); d.ControlDom.find(".jscFileName").find("span").css("background", ""), d.ControlDom.find(".jscFileName").find("span").removeClass("jscColor"), d.ControlDom.find(".jscFileName").eq(a).find("span").css("background", "#67a2fb"), d.ControlDom.find(".jscFileName").eq(a).find("span").attr("class", "jscColor") }), d.ControlDom.find(".jscCreateFolder").on("click", function () { var h, a = e.join("/"), b = d.ControlDom.find(".jscFolderNameText").val(), c = ""; return "" == b ? (Cmn.alert("文件名不能为空"), void 0) : (c = a + "/" + b, h = function (a) { var b, c, d; for (b = 0; b < f.length; b++) { c = !0; for (d in f[b]) if (f[b][d] != a) { c = !1; break } if (c) return b } }(d.ControlDom.find(".jscFolderNameText").val()), h >= 0 ? (Cmn.alert("你输入的文件名已存在请重新输入！"), d.ControlDom.find(".jscFolderNameText").val(""), void 0) : (CmnAjax.PostData(InterfaceUrl + "?method=[Cms]Cms.Model.CreateFile", { Path: c }, function (b) { 1 == b.IsSuccess && (g(a), d.ControlDom.find(".jscFolderNameText").val("")) }), void 0)) }), d.ControlDom.undelegate(".jscHide", "click").delegate(".jscHide", "click", function () { d.ControlDom.find(".jscServerDirectoryWrap").hide() }), d.ControlDom.find(".jscChooseList").on("click", function () { e = [""], g(), d.ControlDom.find(".jscServerDirectoryWrap").show() }), d.ControlDom.undelegate(".jscDetermine", "click").delegate(".jscDetermine", "click", function () { var b, a = d.ControlDom.find(".jscColor").text(); "" != a && (a = "/" + a), b = e.join("/") + a, "" == b && (b = "/"), "" != b && d.SetValue(b), d.ControlDom.find(".jscServerDirectoryWrap").hide() }) }, d.GetValue = function () { return d.ControlDom.find(".jscServerPathText").val() }, d.SetValue = function (a) { d.ControlDom.find(".jscServerPathText").val(a) } } });