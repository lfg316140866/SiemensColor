CmnMis_UI_Control_HtmlEditor_Version="2.1",function(){var a=CmnMis.UI.Control;a.HtmlEditor=function(b,c){Cmn.Object.Inherit(this,a.BasControl,[b,c]);var d=this;d.Type="HtmlEditor",d.SetCfgDescCfg({SavePath:{Type:"Text",Desc:"上传保存的路径",Val:"/Upload/HtmlEdit/"},Width:{Type:"Text",Desc:"控件高度",Val:"750"},Height:{Type:"Text",Desc:"控件高度",Val:"250"}}),d.ControlCfg=d.InitControlConfig(Cmn.Extend(d.ControlCfg,c)),d.GetInitHtml=function(){return'<textarea name="cmn_htmlEidt_TextArea" class="cmn_htmlEidt_TextArea" rows="12" cols="80" style="width:auto"></textarea>'},d.InitControl=function(){d.ControlDom.find(a.Selector.CtlContent).css({border:"1px solid #e6e6e6","line-height":"normal"});var c=d.ControlDom.find(".cmn_htmlEidt_TextArea"),e=InterfaceUrl+"?method=Upload";d.ControlCfg.ItfUrl&&(d.ControlCfg.ItfUrl=d.ControlCfg.ItfUrl.indexOf("method=")>1?d.ControlCfg.ItfUrl:d.ControlCfg.ItfUrl+"?method=File"),d.ControlCfg.Tools=d.ControlCfg.Tools||"Removeformat,Blocktag,Fontface,FontSize,|,Bold,Italic,Underline,Strikethrough,FontColor,BackColor,|,Align,List,Outdent,Indent,Hr,|,Link,Unlink,Anchor,Img,Media,Emot,Table,Source,Fullscreen",d.Edit=c.xheditor({tools:d.ControlCfg.Tools,width:d.ControlCfg.Width-10,height:1*d.ControlCfg.Width>600?d.ControlCfg.Height-30:d.ControlCfg.Height-60,upLinkUrl:e+"&SavePath="+d.ControlCfg.SavePath,upLinkExt:"zip,rar,txt",upImgUrl:e+"&SavePath="+d.ControlCfg.SavePath,upImgExt:"jpg,jpeg,gif,png",upFlashUrl:e+"&SavePath="+d.ControlCfg.SavePath,upFlashExt:"swf",upMediaUrl:e+"&SavePath="+d.ControlCfg.SavePath,upMediaExt:"wmv,avi,wma,mp3,mid,mp4"}),setTimeout(function(){d.Edit.exec("Img"),$("#xheCancel").click(),d.Edit.appendHTML("<span></span>")},500),d.ControlCfg.RegexContent&&d.ControlDom.unbind("click").click(function(){d.ControlDom.find(a.Selector.CtlTipDesc).show(),d.ControlDom.find(a.Selector.CtlErrTipDesc).hide().html("")})},d.GetValue=function(){var a=$("<div>"+this.Edit.getSource()+"</div>");return a.find("img").each(function(a,b){var c,e;$(b).attr("src")&&-1!=$(b).attr("src").indexOf("base64")?(c=CmnAjax.GetData(d.ControlCfg.ItfUrl,{inputFileName:"ImageData",ImageData:$(b).attr("src")}),$(b).attr("src",c.path),$(b).attr("_xhe_src","")):$(b).attr("src")&&-1!=$(b).attr("src").indexOf("xheditor_emot")&&(e=window.location.href.substr(0,window.location.href.lastIndexOf("/")+1),c=e+$(b).attr("_xhe_src"),$(b).attr("src",c))}),a.html()},d.SetValue=function(a){this.Edit.setSource((a||"")+" ")},d.SetWidth=function(a){this.ControlDom.find(".cmn_htmlEidt_TextArea").width(a)},d.Init=function(){this.ControlDom.find(".cmn_htmlEidt_TextArea").val(" ")},d.SetFocus=function(){this.Edit&&this.Edit.focus()}}}();