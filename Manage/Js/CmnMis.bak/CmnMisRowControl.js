CmnMis_UI_Control_CmnMisRowControl_Version = "2.3", function () { var a = CmnMis.UI.Control; a.BasRowControl = function (a) { this.OnClick = new Cmn.Event(this), this.OnAfterFillData = new Cmn.Event(this), this.OnInit = new Cmn.Event(this); var d = this; this.Init = function (b) { for (var c = 0; c < b.length; c++) b[c][a] = "<a target='_blank' class='cmn-RowControl-" + a + "'>行控件</a>"; d.OnInit.Trigger([b]) }, this.SetButtonText = function (b) { CmnMis.CurUserForm.GetDom(".cmn-RowControl-" + a).text(b) }, this.AfterFillData = function () { CmnMis.CurUserForm.GetDom(".cmn-RowControl-" + a).unbind("click").bind("click", function () { d.OnClick.Trigger([CmnMis.CurUserForm.GetCurRecKeyVal($(this))]) }), d.OnAfterFillData.Trigger() } }, a.PrintRow = function (b, c, d) { Cmn.Object.Inherit(this, a.BasRowControl, [b, c, d]), this.CfgDescCfg = { ControlType: { Type: "Text", Desc: "控件类型", Val: "RowControl" }, TemplateFileName: { Type: "Text", Desc: "模板文件名(不带文件后缀)" }, Sql: { Type: "TextArea", Desc: "Sql语句" } }, this.OnInit.Add(function (a) { for (var c = 0; c < a.length; c++) a[c][b] = "<a target='_blank' class='cmn-RowControl-" + b + "'><img src='Image/print.gif' /></a>" }, "PrintRow"), this.OnAfterFillData.Add(function () { CmnMis.CurUserForm.GetDom(".cmn-RowControl-" + b).each(function () { var f, a = CmnMis.Func.GetItfUrl(CmnMis.CurUserForm, CmnMis.CurUserForm.Cfg.MethodName.GetRecList), b = CmnMis.CurUserForm.GetRecAjaxParam(), e = "[" + d + "]='" + CmnMis.CurUserForm.GetCurRecKeyVal($(this)) + "'"; b["Condition"] = b["Condition"] ? b["Condition"] + " and " + e : e; for (f in b) a = Cmn.Func.AddParamToUrl(a, f + "=" + encodeURIComponent(b[f])); a = Cmn.Func.AddParamToUrl(CmnAjax.Func.GetProxyUrl(a), "method=GetExcel&FileName=" + c["TemplateFileName"] + (void 0 != c["Sql"] && "" != c["Sql"] ? "&cmn_OutputDataSql=" + encodeURIComponent(c["Sql"]) : "") + "&" + d + "=" + CmnMis.CurUserForm.GetCurRecKeyVal($(this))), $(this).attr("href", a) }) }, "PrintRow") } }();