CmnMis_Func_Version = "2.4", "undefined" == typeof CmnMis && (CmnMis = {}), function () { CmnMis.Func = { GetItfUrl: function (a, b) { return Cmn.Func.AddParamToUrl(Cmn.Func.AddParamToUrl(a.ItfUrl, "CurUserFormID=" + a.UserFormID), "method=" + b) }, IsLoginFromAjax: function (a) { return "0" == a.IsSuccess && void 0 != a.HasNoLogin && "1" == a.HasNoLogin ? (Cmn.alert("由于长时间未操作，需要重新登录！"), window.location.href = Cmn.Func.GetRoot() + "Manage/Login.html?SysName=" + Cmn.Func.GetParamFromUrl("SysName", window.location.href), !1) : !0 }, SetTitle: function () { document.title = CmnMis.Func.GetSysCfg("SysName") }, GetUserFormByID: function (a) { for (var b = 0; b < CmnMis.Frame.UserFormList.length; b++) if (CmnMis.Frame.UserFormList[b].UserFormID == a) return CmnMis.Frame.UserFormList[b]; return null }, GetUserFormIDByDesc: function (a) { var c, b = ""; for (c = 0; c < CmnMis.Frame.UserFormList.length; c++) if (CmnMis.Frame.UserFormList[c].UserFormDesc == a) { b = CmnMis.Frame.UserFormList[c].UserFormID; break } return "" == b && CmnMis.TableOpt.GetData("cmn_usr_userform", { Condition: "[formdesc]='" + a + "'" }, !0, function (a) { a.data.length > 0 && (b = a.data[0]["userformid"]) }), b }, SetUserFormCol_UserFormID: "", ShowSetUserFormCol: function (a, b) { return "" == CmnMis.Func.SetUserFormCol_UserFormID && (CmnMis.Func.SetUserFormCol_UserFormID = CmnMis.Func.GetUserFormIDByDesc("表单字段配置"), "" == CmnMis.Func.SetUserFormCol_UserFormID) ? (Cmn.alert("找不到用户表单名称为'表单字段配置'的用户表单，请到用户表单管理中检查表单名称。"), void 0) : (CmnMis.Frame.ShowUserForm(CmnMis.Func.SetUserFormCol_UserFormID, { ViewState: CmnMis.CurUserForm.Cfg.ViewState.RecList, Condition: "[userformid]=" + a, ReturnUserFormID: b }), void 0) }, DetailUserFormList: new Array, GetDetailUserFormInfoByID: function (userFormID) { var _i, _data, _retUserFormInfo = null; for (_i = 0; _i < CmnMis.Func.DetailUserFormList.length; _i++) if (CmnMis.Func.DetailUserFormList[_i].UserFormID == userFormID) { _retUserFormInfo = CmnMis.Func.DetailUserFormList[_i]; break } if (null == _retUserFormInfo) { for (_data = CmnAjax.GetData(InterfaceUrl + "?method=GetUserFormInfo", "{UserFormID:'" + userFormID + "'}"), CmnMis.Func.IsLoginFromAjax(_data), _retUserFormInfo = new CmnMis.UserForm, _retUserFormInfo.IsDetailUserForm = !0, _retUserFormInfo.ParentUserFormID = CmnMis.CurUserForm.UserFormID, _retUserFormInfo.ColInfo = _data.data, _retUserFormInfo = CmnMis.Func.CheckColInfo(_retUserFormInfo), _retUserFormInfo.KeyColName = _data.KeyColName, _retUserFormInfo.ItfUrl = InterfaceUrl, _retUserFormInfo.UserFormUrl = _data.formurl, _retUserFormInfo.UserFormID = _data.userformid, _retUserFormInfo.UserFormDesc = _data.formdesc, _retUserFormInfo.ModuleDesc = _data.userformmoduledesc, _retUserFormInfo.ModuleID = _data.userformmoduleid, _retUserFormInfo.TableName = _data.tablename, _retUserFormInfo.ListTemplateFileName = _data.ListTemplateFileName, _retUserFormInfo.EditTemplateFileName = _data.EditTemplateFileName, _retUserFormInfo.JsTemplateFileName = _data.JsTemplateFileName, void 0 != _data.ExdCfg && (_retUserFormInfo.ExdCfg = eval("(" + _data.ExdCfg + ")")), _retUserFormInfo.AllowAdd = _data["AllowAdd"], _retUserFormInfo.AllowDell = _data["AllowDell"], _retUserFormInfo.AllowModify = _data["AllowModify"], _retUserFormInfo.AllowToExcel = _data["AllowToExcel"], _retUserFormInfo.RecPageSize = null == _data.pagesize ? 15 : _data.pagesize, _i = 0; _i < _retUserFormInfo.ColInfo.length; _i++) "1" == _retUserFormInfo.ColInfo[_i].IsShowInGrid && (_retUserFormInfo.ColInfoRecList[_retUserFormInfo.ColInfoRecList.length] = _retUserFormInfo.ColInfo[_i]); _retUserFormInfo.TableCache = new CmnMis.TableCache, CmnMis.Func.DetailUserFormList[CmnMis.Func.DetailUserFormList.length] = _retUserFormInfo } return _retUserFormInfo.ParentUserFormID = CmnMis.CurUserForm.UserFormID, _retUserFormInfo }, SysCfgCache: {}, GetSysCfg: function (a, b) { var c, d; return "" == a || void 0 == a || null == a ? "" : (void 0 == b && (b = !0), c = null, b && (c = CmnMis.Func.SysCfgCache[a]), (null == c || void 0 == c) && (d = CmnAjax.GetData(Cmn.Func.AddParamToUrl(CmnMis.Func.GetCmnItfUrl(), "method=GetSysCfg"), "{CfgKey:'" + a + "'}"), void 0 != d && "1" == d.IsSuccess ? (c = d.CfgValue, (void 0 == c || null == c) && (c = ""), b && (CmnMis.Func.SysCfgCache[a] = c)) : c = ""), c) }, _CurDBIsMsSql: null, CurDBIsMsSql: function () { if (null === CmnMis.Func._CurDBIsMsSql) { var a = CmnAjax.GetData(Cmn.Func.AddParamToUrl(CmnMis.Func.GetCmnItfUrl(), "method=IsMsSql"), {}); CmnMis.Func._CurDBIsMsSql = "1" == a["IsMsSql"] ? !0 : !1 } return CmnMis.Func._CurDBIsMsSql }, ProcSqlStr: function (a) { return a.length > 0 && "'" != a.charAt(0) && (a = "'" + a + "'"), CmnMis.Func.CurDBIsMsSql() && (a = "N" + a), a }, SubmitData: function (containerSelector, methodName, param, checkRegular, errDispSelector, submitingHintSelector, successFunc, errorFunc) { if (CmnMis.UI.Control.VerifyControlInput(containerSelector, errDispSelector, function (a) { errorFunc ? !errorFunc(a) == !1 && Cmn.alert(a.Msg) : Cmn.alert(a.Msg) }) !== !1) { var _data = CmnMis.UI.Control.GetValueList(containerSelector); param && "" != param && (Cmn.Func.IsString(param) && (param = eval("(" + param + ")")), $.extend(_data, param)), CmnAjax.PostData(methodName, _data, function (a) { CmnMis.Func.IsLoginFromAjax(a), null != successFunc && void 0 != successFunc && successFunc(a) }, errorFunc) } }, CheckColInfo: function (userforminfo) { return $.each(userforminfo.ColInfo, function (index, item) { "" == item.ControlCfg ? item.ControlCfg = {} : "string" == typeof item.ControlCfg && (userforminfo.ColInfo[index].ControlCfg = eval("(" + item.ControlCfg + ")")), userforminfo.ColInfo[index].ColWidth = userforminfo.ColInfo[index].ColWidth + "px", void 0 == userforminfo.ColInfo[index].ControlCfg["Default"] && "" != userforminfo.ColInfo[index].DefaultValue && (userforminfo.ColInfo[index].ControlCfg["Default"] = userforminfo.ColInfo[index].DefaultValue), userforminfo.ColInfo[index].ControlCfg["IsRequired"] = userforminfo.ColInfo[index].IsRequired, userforminfo.ColInfo[index].ControlCfg["RegexContent"] = userforminfo.ColInfo[index].RegexContent, userforminfo.ColInfo[index].ControlCfg["RegexErrorMsg"] = userforminfo.ColInfo[index].RegexErrorMsg, userforminfo.ColInfo[index].ControlCfg["ColTitle"] = userforminfo.ColInfo[index].ColTitle, userforminfo.ColInfo[index].ControlCfg["ColHint"] = userforminfo.ColInfo[index].ColHint, userforminfo.ColInfo[index].ControlCfg["DefaultValue"] = userforminfo.ColInfo[index].DefaultValue, userforminfo.KeyColName == userforminfo.ColInfo[index].ColName && (userforminfo.ColInfo[index].ControlCfg["IsRequired"] = "0") }), userforminfo }, GetLoginUserID: function () { var a = CmnAjax.GetData(Cmn.Func.AddParamToUrl(CmnMis.Func.GetCmnItfUrl(), "method=GetUserID")); return a.UserID }, CurUserIsSysAdmin: null, IsSysAdmin: function () { if (null == CmnMis.Func.CurUserIsSysAdmin) { var a = CmnAjax.GetData(Cmn.Func.AddParamToUrl(CmnMis.Func.GetCmnItfUrl(), "method=IsSysAdmin")); CmnMis.Func.CurUserIsSysAdmin = "1" == a["IsSysAdmin"] ? !0 : !1 } return CmnMis.Func.CurUserIsSysAdmin }, CmnInterfaceUrl: InterfaceUrl, HasSetCmnInterfaceUrl: !1, GetCmnItfUrl: function (a) { 0 == CmnMis.Func.HasSetCmnInterfaceUrl && (CmnMis.Func.CmnInterfaceUrl = InterfaceUrl, CmnMis.Func.HasSetCmnInterfaceUrl = !0), ("" == CmnMis.Func._Cmn || void 0 == CmnMis.Func.CmnInterfaceUrl) && CmnMis.Func.SetCmnItfUrl(InterfaceUrl); var b = CmnMis.Func.CmnInterfaceUrl; return void 0 != a && "" != a && (b = Cmn.Func.AddParamToUrl(b, "method=" + a)), b }, SetCmnItfUrl: function (a) { CmnMis.Func.CmnInterfaceUrl = a, CmnMis.Func.HasSetCmnInterfaceUrl = !0 }, HasRight: function (a, b) { var d, c = ""; return c = Cmn.Func.IsString(a) ? a : a.UserFormID, d = CmnAjax.GetData(CmnMis.Func.GetCmnItfUrl("HasRight"), { UserFormID: c, RightName: b }), void 0 != d && "1" == d.HasRight ? !0 : !1 }, Translate: function (a) { var b = "method=Translate"; return b = Cmn.Func.AddParamToUrl(CmnMis.Func.GetCmnItfUrl(), b), _retData = CmnAjax.GetData(b, { Txt: a }), _retData.TranslateTxt }, LanguageType: { Chinese: "chinese", English: "english" }, CurLanguageType: "", GetCurLanguage: function () { return "" === CmnMis.Func.CurLanguageType && (_retData = CmnAjax.GetData(Cmn.Func.AddParamToUrl(CmnMis.Func.GetCmnItfUrl(), "method=GetCurLanguageType")), CmnMis.Func.CurLanguageType = _retData.CurLanguageType), CmnMis.Func.CurLanguageType }, FormatString: function (a, b) { var c = a; return "" == c ? c : (b = Cmn.Func.Trim(b.replace("{0:", "").replace("}", "")), b.indexOf("-") > 0 || b.indexOf("/") > 0 ? c = CmnMis.Func.FormatDate(a, b) : "f" == b[0] && (c = parseFloat(a).toFixed(parseInt(b.replace("f", "")))), c) }, FormatDate: function (a, b) { if (a) { switch (b || (b = "yyyy-MM-dd"), b = b.replace("yyyy-mm-dd", "yyyy-MM-dd"), typeof a) { case "string": a = new Date(a.replace(/-/g, "/")); break; case "number": a = new Date(a) } if (!(!a instanceof Date)) { var c = { yyyy: a.getFullYear(), M: a.getMonth() + 1, d: a.getDate(), H: a.getHours(), m: a.getMinutes(), s: a.getSeconds(), MM: ("" + (a.getMonth() + 101)).substr(1), dd: ("" + (a.getDate() + 100)).substr(1), HH: ("" + (a.getHours() + 100)).substr(1), mm: ("" + (a.getMinutes() + 100)).substr(1), ss: ("" + (a.getSeconds() + 100)).substr(1) }; return b.replace(/(yyyy|MM?|dd?|HH?|ss?|mm?)/g, function () { return c[arguments[0]] }) } } }, RootPathToManageDir: function (a) { return a = Cmn.Func.Trim(a), "/" == a.charAt(0) ? a = Cmn.Func.AddSiteRoot(a) : null == a.match(/^http:/i) && (a = "../" + a), a } } }(), function () { var a = {}, b = null, c = function (a, b, c) { this.DOM = $("<div class='cmnMisFunc-PopWin-Content'>"), b === CmnMis.PopWin.Type.Center ? this.DOM.attr("style", "width: 80%; height: 80%;left:50%;top:50%;margin-top:" + $(window).height() * -.8 / 2 + "px;margin-left:" + $(window).width() * -.8 / 2) : b !== CmnMis.PopWin.Type.Right && b || this.DOM.attr("style", "width: 50%; height: 100%;right:0%;top:0%;"), this.DOM.css(Cmn.Extend({ position: "absolute", background: " #fff", display: "none" }, c)), this.DOM.append(a), this.Show = function () { return $(this.DOM).hasClass("cmnMisFunc-PopWin-Container-StateShow") ? !1 : (b === CmnMis.PopWin.Type.Center || b !== CmnMis.PopWin.Type.Right && b || this.DOM.css({ right: "-100%", opacity: "0", display: "block" }).animate({ right: "0%", opacity: "1" }).addClass("cmnMisFunc-PopWin-Container-StateShow"), void 0) }, this.Hide = function (a) { return $(this.DOM).hasClass("cmnMisFunc-PopWin-Container-StateShow") ? (a || 0 == arguments.length ? b === CmnMis.PopWin.Type.Center || b !== CmnMis.PopWin.Type.Right && b || this.DOM.stop().removeClass("cmnMisFunc-PopWin-Container-StateShow").animate({ right: "-100%", opacity: "0" }, 300, function () { $(this).hide() }) : this.DOM.removeClass("cmnMisFunc-PopWin-Container-StateShow").hide(), void 0) : !1 } }; CmnMis.Hint = { Show: function () { var b, c, d, a = $("body").find(".cmn-ProcessInHintLayer"); a.length <= 0 && (a = $('<div class="cmn-ProcessInHintLayer" style="display: none;overflow:hidden; width: 100%; height: 100%; position: fixed; right: 0px; top: 0px; z-index: 10003"></div>'), a.append('<div style="position: absolute; width: 100%; height: 100%; background: #ccc; filter: alpha(opacity=70); opacity: 0.7;z-index:1;"></div>'), b = $('<div style="position: absolute;left:50%;top:50%;color:#5C4F4F;text-align: center;z-index:2;width:150px;height:100px;margin-top:-75px;margin-left:-75px;"></div>'), b.append('<img style="width:60px;" src="Image/frame/frame_ProcessInHint.gif" /><div class="cmn-ProcessInHintText" style="font-size: 16px; width: 100px; margin: auto; text-align: left; ">Please wait<b style="font-size:20px;">...</b></div>'), a.append(b), $("body").append(a)), c = 0, d = a.find(".cmn-ProcessInHintText b"), a[0].setintervalkey = setInterval(function () { 0 == c ? d.html("") : 1 == c ? d.html(".") : 2 == c ? d.html("..") : 3 == c && (d.html("..."), c = -1), c++ }, 400), a.show() }, Hide: function () { clearInterval($("body").find(".cmn-ProcessInHintLayer")[0].setintervalkey), $("body").find(".cmn-ProcessInHintLayer").hide() } }, CmnMis.PopWin = { Type: { Right: "Right", Center: "Center" }, Show: function (d, e, f, g) { var i, j, k, l, h = $(".cmnMisFunc-PopWin-Container"); h.length <= 0 && (h = $('<div class="cmnMisFunc-PopWin-Container"></div>'), h.attr("style", "display: none;overflow:hidden; width: 100%; height: 100%;position: fixed; right: 0px; top: 0px; z-index: 10001"), i = $('<div class="cmnMisFunc-PopWin-Mask"></div>'), i.attr("style", "position: absolute; width: 100%; height: 100%; background: #000;filter: alpha(opacity=60); opacity: 0.6;z-index:1;"), h.append(i), j = $('<div class="cmnMisFunc-PopWin-ContentContainer"></div>'), j.attr("style", "position: absolute; width: 100%; height: 100%;z-index:2;"), h.append(j), $("body").append(h)), k = null, Cmn.IsType(d, "string") && (d.indexOf(".htm") > 0 && !a[d] ? (d = $("<div key-id='" + d + "'></div>"), d.load(d.attr("key-id"))) : d.indexOf(".htm") > 0 && a[d] && (d = a[d].DOM)), $(d).attr("key-id") && a[$(d).attr("key-id")] ? k = a[$(d).attr("key-id")] : (l = g || Cmn.GetUUID(), $(d).attr("key-id") ? l = $(d).attr("key-id") : $(d).attr("key-id", l), k = new c(d, e, f), k.DOM.attr("key-id", l), a[l] = k, h.find(".cmnMisFunc-PopWin-ContentContainer").append(k.DOM)), b && b.DOM.hide(), b = k, h.show(), b.Show() }, Hide: function () { if (b) { b.Hide(); var c = $(".cmnMisFunc-PopWin-Container").find(".cmnMisFunc-PopWin-Container-StateShow"); c.length > 0 ? b = a[c.attr("key-id")] : $(".cmnMisFunc-PopWin-Container").fadeOut() } }, HideAll: function () { $.each(a, function () { this.Hide(!1) }), b = null, $(".cmnMisFunc-PopWin-Container").fadeOut() } } }();